# 3.21 WordPress Coding Standards for Secure Development - Study Notes

## Overview

WordPress Coding Standards (WPCS) enforce security best practices, code consistency, and maintainability. Following these standards helps prevent security vulnerabilities and ensures code quality.

**Key Reference:** [WordPress Coding Standards - WordPress Developer Resources](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/)

---

## 1. PHP Coding Standards

### Security-Focused Standards

**Data Validation:**
```php
// ✅ GOOD - Validate input
$user_id = isset( $_GET['user_id'] ) ? absint( $_GET['user_id'] ) : 0;

// ❌ BAD - No validation
$user_id = $_GET['user_id'];
```

**Data Sanitization:**
```php
// ✅ GOOD - Sanitize before storage
$title = sanitize_text_field( $_POST['title'] );
update_post_meta( $post_id, 'title', $title );

// ❌ BAD - No sanitization
update_post_meta( $post_id, 'title', $_POST['title'] );
```

**Output Escaping:**
```php
// ✅ GOOD - Escape output
echo '<div>' . esc_html( $user_content ) . '</div>';

// ❌ BAD - No escaping
echo '<div>' . $user_content . '</div>';
```

---

## 2. Security Best Practices in WPCS

### Prepared Statements

```php
// ✅ GOOD - Use prepared statements
global $wpdb;
$query = $wpdb->prepare(
	"SELECT * FROM {$wpdb->posts} WHERE ID = %d AND post_status = %s",
	$post_id,
	$status
);

// ❌ BAD - String concatenation
$query = "SELECT * FROM {$wpdb->posts} WHERE ID = $post_id";
```

### Capability Checks

```php
// ✅ GOOD - Check capabilities
if ( ! current_user_can( 'edit_post', $post_id ) ) {
	wp_die( 'Permission denied' );
}

// ❌ BAD - No capability check
// Proceed with action
```

### Nonce Verification

```php
// ✅ GOOD - Verify nonce
if ( ! isset( $_POST['nonce'] ) || ! wp_verify_nonce( $_POST['nonce'], 'action' ) ) {
	wp_die( 'Security check failed' );
}

// ❌ BAD - No nonce check
// Process form
```

---

## 3. Code Organization

### File Structure

```
plugin-name/
├── plugin-name.php
├── includes/
│   ├── class-plugin-name.php
│   ├── class-admin.php
│   └── functions.php
├── admin/
│   └── class-settings.php
└── public/
    └── class-public.php
```

### Naming Conventions

```php
// Classes: PascalCase
class Plugin_Name_Admin {}

// Functions: snake_case
function plugin_name_get_option() {}

// Constants: UPPERCASE
define( 'PLUGIN_NAME_VERSION', '1.0.0' );

// Variables: snake_case
$user_id = 123;
```

---

## 4. PHPCS Configuration

### phpcs.xml

```xml
<?xml version="1.0"?>
<ruleset name="WordPress">
	<description>WordPress Coding Standards</description>

	<!-- Include WordPress standards -->
	<rule ref="WordPress"/>

	<!-- Exclude specific rules if needed -->
	<rule ref="WordPress.NamingConventions.PrefixAllGlobals">
		<properties>
			<property name="prefixes" type="array" value="my_plugin"/>
		</properties>
	</rule>
</ruleset>
```

### Running PHPCS

```bash
# Install PHPCS
composer require --dev squizlabs/php_codesniffer
composer require --dev wp-coding-standards/wpcs

# Run PHPCS
./vendor/bin/phpcs --standard=WordPress plugin-file.php

# Auto-fix issues
./vendor/bin/phpcbf --standard=WordPress plugin-file.php
```

---

## 5. Security-Specific Rules

### Input Validation

```php
// WPCS requires validation
// ✅ GOOD
if ( ! isset( $_POST['data'] ) ) {
	return;
}
$data = sanitize_text_field( $_POST['data'] );

// ❌ BAD - PHPCS will flag
$data = $_POST['data'];
```

### Output Escaping

```php
// WPCS requires escaping
// ✅ GOOD
echo esc_html( $content );
echo esc_attr( $attribute );
echo esc_url( $url );

// ❌ BAD - PHPCS will flag
echo $content;
```

### Database Queries

```php
// WPCS requires prepared statements
// ✅ GOOD
$wpdb->prepare( "SELECT * FROM table WHERE id = %d", $id );

// ❌ BAD - PHPCS will flag
"SELECT * FROM table WHERE id = $id"
```

---

## 6. Documentation Standards

### PHPDoc Comments

```php
/**
 * Retrieves a post by ID.
 *
 * @since 1.0.0
 *
 * @param int $post_id Post ID.
 * @return WP_Post|false Post object on success, false on failure.
 */
function get_post_by_id( $post_id ) {
	// Implementation
}
```

### Inline Comments

```php
// Check user capability before proceeding
if ( ! current_user_can( 'edit_post', $post_id ) ) {
	return false;
}

// Sanitize input before database storage
$title = sanitize_text_field( $_POST['title'] );
```

---

## 7. Best Practices

### 1. Always Validate Input
- Check if variables exist
- Validate data types
- Use WordPress validation functions

### 2. Always Sanitize Before Storage
- Use appropriate sanitization functions
- Sanitize based on data type
- Never trust user input

### 3. Always Escape Output
- Escape based on context
- Use appropriate escaping functions
- Never output raw user data

### 4. Use Prepared Statements
- Always use wpdb::prepare()
- Never concatenate user input into queries
- Use proper placeholders

### 5. Check Capabilities
- Always verify user permissions
- Use current_user_can()
- Check before actions

### 6. Verify Nonces
- Always verify nonces for forms
- Use appropriate verification functions
- Include nonces in all forms

---

## Exam Tips

### Key Points to Remember

1. **WPCS Requirements:**
   - Input validation
   - Output escaping
   - Prepared statements
   - Capability checks
   - Nonce verification

2. **Security Focus:**
   - Validate, sanitize, escape
   - Use WordPress functions
   - Follow best practices
   - Code review standards

3. **Tools:**
   - PHPCS for linting
   - PHPCBF for auto-fixing
   - CI/CD integration

---

## Additional Resources

- [WordPress Coding Standards - WordPress Developer Resources](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/)
- [PHP Coding Standards - WordPress Developer Resources](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/php/)
