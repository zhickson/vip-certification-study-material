# 3.9 Secure WordPress Configuration Practices - Study Notes

## Overview

WordPress configuration security involves hardening core settings, securing sensitive files, and implementing proper file permissions. This topic covers best practices for securing WordPress installations at the configuration level.

**Key Reference:** [Hardening WordPress - WordPress Codex](https://codex.wordpress.org/Hardening_WordPress)

---

## 1. Securing wp-config.php

### File Location and Protection

`wp-config.php` contains sensitive information including database credentials and security keys. It should be protected from direct access.

#### Server-Level Protection

**Apache (.htaccess):**
```apache
<Files wp-config.php>
	Order allow,deny
	Deny from all
</Files>
```

**Nginx:**
```nginx
location ~* wp-config.php {
	deny all;
}
```

#### Move wp-config.php

For additional security, move `wp-config.php` one directory above the WordPress root:

```
/var/www/
  wp-config.php  (one level up)
  wordpress/
    index.php
    wp-load.php
```

Then update `wp-load.php` to look for it:
```php
// In wp-load.php
if ( file_exists( ABSPATH . 'wp-config.php' ) ) {
	require_once ABSPATH . 'wp-config.php';
} elseif ( file_exists( dirname( ABSPATH ) . '/wp-config.php' ) ) {
	require_once dirname( ABSPATH ) . '/wp-config.php';
}
```

### Security Keys and Salts

WordPress uses security keys and salts for encryption. These should be unique and strong.

**Generate new keys:**
```php
// Visit: https://api.wordpress.org/secret-key/1.1/salt/
// Or use WP-CLI:
// wp config shuffle-salts
```

**wp-config.php example:**
```php
define( 'AUTH_KEY',         'unique key here' );
define( 'SECURE_AUTH_KEY',  'unique key here' );
define( 'LOGGED_IN_KEY',    'unique key here' );
define( 'NONCE_KEY',        'unique key here' );
define( 'AUTH_SALT',        'unique key here' );
define( 'SECURE_AUTH_SALT', 'unique key here' );
define( 'LOGGED_IN_SALT',   'unique key here' );
define( 'NONCE_SALT',       'unique key here' );
```

---

## 2. File Permissions

### Recommended Permissions

**Files:**
- PHP files: `644` (readable by owner and group, writable by owner)
- Configuration files: `600` (readable/writable by owner only)

**Directories:**
- WordPress directories: `755` (executable by owner and group)
- wp-content/uploads: `755` (or `750` for stricter security)

**wp-config.php:**
- `600` or `640` (owner read/write, group read if needed)

### Setting Permissions

```bash
# Files
find /path/to/wordpress -type f -exec chmod 644 {} \;

# Directories
find /path/to/wordpress -type d -exec chmod 755 {} \;

# wp-config.php
chmod 600 wp-config.php

# wp-content/uploads
chmod 755 wp-content/uploads
```

### Ownership

Files should be owned by the web server user:

```bash
# Find web server user
ps aux | grep -E '[a]pache|[h]ttpd|[_]www|[w]ww-data|[n]ginx'

# Set ownership
chown -R www-data:www-data /path/to/wordpress
```

---

## 3. Disabling File Editing

### Disable Plugin/Theme Editor

In `wp-config.php`:
```php
define( 'DISALLOW_FILE_EDIT', true );
```

This prevents editing of plugin and theme files from the WordPress admin, even if a user has the `edit_plugins` or `edit_themes` capability.

### Disable File Modifications

```php
define( 'DISALLOW_FILE_MODS', true );
```

This prevents:
- Installing/updating plugins and themes
- Editing plugin/theme files
- Requires FTP credentials for updates

---

## 4. Database Security

### Database User Permissions

The database user should have minimal required permissions:

```sql
-- Grant only necessary permissions
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER
ON database_name.*
TO 'wp_user'@'localhost';
FLUSH PRIVILEGES;
```

### Database Prefix

Change the default `wp_` table prefix:

```php
// In wp-config.php
$table_prefix = 'wp_custom_';
```

### Database Credentials

Store credentials securely in `wp-config.php`:

```php
define( 'DB_NAME', 'database_name' );
define( 'DB_USER', 'database_user' );
define( 'DB_PASSWORD', 'strong_password' );
define( 'DB_HOST', 'localhost' );
```

Never commit `wp-config.php` to version control.

---

## 5. Security Headers

### Add Security Headers

In `.htaccess` (Apache):
```apache
# Prevent clickjacking
Header always set X-Frame-Options "SAMEORIGIN"

# XSS Protection
Header always set X-XSS-Protection "1; mode=block"

# Prevent MIME type sniffing
Header always set X-Content-Type-Options "nosniff"

# Referrer Policy
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Content Security Policy (adjust as needed)
Header always set Content-Security-Policy "default-src 'self'"
```

Or in `wp-config.php`:
```php
// Add security headers via PHP
function add_security_headers() {
	header( 'X-Frame-Options: SAMEORIGIN' );
	header( 'X-XSS-Protection: 1; mode=block' );
	header( 'X-Content-Type-Options: nosniff' );
	header( 'Referrer-Policy: strict-origin-when-cross-origin' );
}
add_action( 'send_headers', 'add_security_headers' );
```

---

## 6. Error Reporting

### Disable Error Display in Production

In `wp-config.php`:
```php
// Hide errors from visitors
define( 'WP_DEBUG', false );
define( 'WP_DEBUG_DISPLAY', false );
define( 'WP_DEBUG_LOG', true ); // Log errors to file

// Or set in php.ini
ini_set( 'display_errors', 0 );
ini_set( 'log_errors', 1 );
```

### Development vs Production

**Development:**
```php
define( 'WP_DEBUG', true );
define( 'WP_DEBUG_DISPLAY', true );
define( 'WP_DEBUG_LOG', true );
define( 'SCRIPT_DEBUG', true );
```

**Production:**
```php
define( 'WP_DEBUG', false );
define( 'WP_DEBUG_DISPLAY', false );
define( 'WP_DEBUG_LOG', false );
define( 'SCRIPT_DEBUG', false );
```

---

## 7. Additional Security Settings

### Limit Login Attempts

```php
// In wp-config.php or functions.php
define( 'WP_FAIL2BAN_BLOCKED_USERS', array( 'admin', 'administrator' ) );
```

Or use a plugin like Limit Login Attempts.

### Disable XML-RPC

If not needed:
```php
// In functions.php
add_filter( 'xmlrpc_enabled', '__return_false' );
```

Or block in `.htaccess`:
```apache
<Files xmlrpc.php>
	Order allow,deny
	Deny from all
</Files>
```

### Hide WordPress Version

```php
// Remove version from head
remove_action( 'wp_head', 'wp_generator' );

// Remove version from RSS
add_filter( 'the_generator', '__return_empty_string' );
```

### Disable File Execution in Uploads

In `.htaccess` in `wp-content/uploads/`:
```apache
<Files *.php>
	deny from all
</Files>
```

---

## 8. Environment-Specific Configuration

### Separate Configurations

Use environment variables:

```php
// In wp-config.php
define( 'DB_NAME', getenv( 'DB_NAME' ) );
define( 'DB_USER', getenv( 'DB_USER' ) );
define( 'DB_PASSWORD', getenv( 'DB_PASSWORD' ) );
define( 'DB_HOST', getenv( 'DB_HOST' ) ?: 'localhost' );

// Environment-specific settings
if ( getenv( 'WP_ENV' ) === 'production' ) {
	define( 'WP_DEBUG', false );
	define( 'DISALLOW_FILE_EDIT', true );
} else {
	define( 'WP_DEBUG', true );
	define( 'WP_DEBUG_LOG', true );
}
```

---

## 9. Best Practices Summary

### 1. Protect wp-config.php
- Restrict file access via server config
- Use proper file permissions (600)
- Move above web root if possible

### 2. Use Strong Security Keys
- Generate unique keys for each site
- Rotate keys periodically
- Never share keys

### 3. Set Proper File Permissions
- Files: 644
- Directories: 755
- wp-config.php: 600

### 4. Disable File Editing
- Set `DISALLOW_FILE_EDIT`
- Use `DISALLOW_FILE_MODS` if needed

### 5. Secure Database
- Use strong passwords
- Limit database user permissions
- Change table prefix

### 6. Add Security Headers
- X-Frame-Options
- X-XSS-Protection
- X-Content-Type-Options
- Content-Security-Policy

### 7. Configure Error Reporting
- Disable display in production
- Enable logging for debugging
- Use environment-specific settings

---

## Exam Tips

### Key Points to Remember

1. **wp-config.php Security:**
   - Protect with server rules
   - Use file permissions 600
   - Move above web root if possible

2. **Security Keys:**
   - Must be unique per site
   - Generate from WordPress.org
   - Rotate periodically

3. **File Permissions:**
   - Files: 644
   - Directories: 755
   - wp-config.php: 600

4. **Configuration Constants:**
   - `DISALLOW_FILE_EDIT` - Disable editor
   - `DISALLOW_FILE_MODS` - Disable all file mods
   - `WP_DEBUG` - Debug mode

5. **Common Mistakes:**
   - Weak security keys
   - Incorrect file permissions
   - Exposing wp-config.php
   - Displaying errors in production

---

## Additional Resources

- [Hardening WordPress - WordPress Codex](https://codex.wordpress.org/Hardening_WordPress)
- [Editing wp-config.php - WordPress Codex](https://codex.wordpress.org/Editing_wp-config.php)
- [Security Keys - WordPress Codex](https://codex.wordpress.org/Editing_wp-config.php#Security_Keys)
