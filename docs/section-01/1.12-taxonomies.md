# 1.12 Taxonomies - Study Notes

## Overview

Taxonomies in WordPress are a way to group posts together. WordPress comes with two built-in taxonomies (categories and tags), but you can create custom taxonomies to organize content in any way you need. Understanding how to register, query, and work with taxonomies is essential for WordPress development.

**Key Reference:** [Taxonomies - WordPress Developer Resources](https://developer.wordpress.org/plugins/taxonomies/)

---

## 1. Use Categories and Tags Effectively

### Categories

- **Hierarchical:** Can have parent/child relationships
- **Use For:** Broad content organization
- **Example:** News → Sports → Football

```php
// Get categories
$categories = get_categories( array(
	'orderby' => 'name',
	'order' => 'ASC',
) );

// Get category
$category = get_category( $cat_id );

// Check if in category
if ( in_category( 'news' ) ) {
	// Display category-specific content
}
```

### Tags

- **Non-hierarchical:** Flat structure
- **Use For:** Specific topics, keywords
- **Example:** "wordpress", "tutorial", "beginner"

```php
// Get tags
$tags = get_tags( array(
	'orderby' => 'count',
	'order' => 'DESC',
) );

// Get tag
$tag = get_tag( $tag_id );

// Check if has tag
if ( has_tag( 'wordpress' ) ) {
	// Display tag-specific content
}
```

---

## 2. Register Custom Taxonomies with Labels and Rewrite Rules

### Registering Custom Taxonomies

**Function:** `register_taxonomy( $taxonomy, $object_type, $args = array() )`

**Core Implementation:**
```518:574:wordpress/wp-includes/taxonomy.php
function register_taxonomy( $taxonomy, $object_type, $args = array() ) {
	global $wp_taxonomies;

	if ( ! is_array( $wp_taxonomies ) ) {
		$wp_taxonomies = array();
	}

	$args = wp_parse_args( $args );

	if ( empty( $taxonomy ) || strlen( $taxonomy ) > 32 ) {
		_doing_it_wrong( __FUNCTION__, __( 'Taxonomy names must be between 1 and 32 characters in length.' ), '4.2.0' );
		return new WP_Error( 'taxonomy_length_invalid', __( 'Taxonomy names must be between 1 and 32 characters in length.' ) );
	}

	$taxonomy_object = new WP_Taxonomy( $taxonomy, $object_type, $args );
	$taxonomy_object->add_rewrite_rules();

	$wp_taxonomies[ $taxonomy ] = $taxonomy_object;

	$taxonomy_object->add_hooks();

	// Add default term.
	if ( ! empty( $taxonomy_object->default_term ) ) {
		$term = term_exists( $taxonomy_object->default_term['name'], $taxonomy );
		if ( $term ) {
			update_option( 'default_term_' . $taxonomy_object->name, $term['term_id'] );
		} else {
			$term = wp_insert_term(
				$taxonomy_object->default_term['name'],
				$taxonomy,
				array(
					'slug'        => sanitize_title( $taxonomy_object->default_term['slug'] ),
					'description' => $taxonomy_object->default_term['description'],
				)
			);

			// Update `term_id` in options.
			if ( ! is_wp_error( $term ) ) {
				update_option( 'default_term_' . $taxonomy_object->name, $term['term_id'] );
			}
		}
	}

	/**
	 * Fires after a taxonomy is registered.
	 *
	 * @since 3.3.0
	 *
	 * @param string       $taxonomy    Taxonomy slug.
	 * @param array|string $object_type Object type or array of object types.
	 * @param array        $args        Array of taxonomy registration arguments.
	 */
	do_action( 'registered_taxonomy', $taxonomy, $object_type, (array) $taxonomy_object );

	/**
	 * Fires after a specific taxonomy is registered.
	 *
```

**Example:**
```php
add_action( 'init', 'register_product_taxonomy' );
function register_product_taxonomy() {
	register_taxonomy(
		'product_category',
		'product',
		array(
			'labels' => array(
				'name' => __( 'Product Categories' ),
				'singular_name' => __( 'Product Category' ),
				'menu_name' => __( 'Categories' ),
			),
			'hierarchical' => true,
			'public' => true,
			'show_ui' => true,
			'show_admin_column' => true,
			'rewrite' => array(
				'slug' => 'product-category',
				'with_front' => false,
				'hierarchical' => true,
			),
		)
	);
}
```

**Key Arguments:**
- `hierarchical` - Whether taxonomy is hierarchical (like categories)
- `public` - Whether taxonomy is publicly queryable
- `show_ui` - Whether to show admin UI
- `show_admin_column` - Show in post list table
- `rewrite` - URL rewrite rules
- `capabilities` - Custom capabilities

---

## 3. Query Taxonomy Terms in Performant Ways

### Getting Terms

**Function:** `get_terms( $args )`

```php
// Get all terms
$terms = get_terms( array(
	'taxonomy' => 'product_category',
	'hide_empty' => false,
) );

// Get terms with specific criteria
$terms = get_terms( array(
	'taxonomy' => 'product_category',
	'parent' => 0, // Top-level only
	'orderby' => 'name',
	'order' => 'ASC',
	'number' => 10, // Limit results
) );
```

### Caching Terms

```php
// ✅ GOOD - Cache expensive queries
$terms = wp_cache_get( 'product_categories' );
if ( false === $terms ) {
	$terms = get_terms( array(
		'taxonomy' => 'product_category',
		'hide_empty' => false,
	) );
	wp_cache_set( 'product_categories', $terms, '', 3600 );
}
```

### Query Posts by Taxonomy

```php
$args = array(
	'post_type' => 'product',
	'tax_query' => array(
		array(
			'taxonomy' => 'product_category',
			'field' => 'slug',
			'terms' => 'electronics',
		),
	),
);

$query = new WP_Query( $args );
```

---

## 4. Handle Pitfalls of Large or Deeply Nested Taxonomies

### Performance Issues

**1. Large Term Lists:**
```php
// ❌ BAD - Gets all terms
$terms = get_terms( 'product_category' );

// ✅ GOOD - Limit and paginate
$terms = get_terms( array(
	'taxonomy' => 'product_category',
	'number' => 20,
	'offset' => $offset,
) );
```

**2. Deep Nesting:**
```php
// Get only top-level terms
$terms = get_terms( array(
	'taxonomy' => 'product_category',
	'parent' => 0,
) );

// Get children of specific term
$children = get_terms( array(
	'taxonomy' => 'product_category',
	'parent' => $parent_id,
) );
```

**3. Expensive Queries:**
```php
// Cache term queries
$cache_key = 'terms_' . md5( serialize( $args ) );
$terms = wp_cache_get( $cache_key );
if ( false === $terms ) {
	$terms = get_terms( $args );
	wp_cache_set( $cache_key, $terms, '', 3600 );
}
```

### Best Practices

- Limit term queries with `number` parameter
- Use `hide_empty => false` only when needed
- Cache frequently accessed terms
- Use `get_term_children()` for hierarchical navigation
- Avoid querying all terms at once

---

## Exam Tips

### Key Points to Remember

1. **Categories vs Tags:**
   - Categories: Hierarchical, broad organization
   - Tags: Non-hierarchical, specific topics

2. **Registering Taxonomies:**
   - Use `register_taxonomy()` on `init` hook
   - Set `hierarchical` for category-like taxonomies
   - Configure `rewrite` for clean URLs

3. **Querying Terms:**
   - Use `get_terms()` with proper arguments
   - Cache expensive queries
   - Limit results with `number` parameter

4. **Performance:**
   - Avoid querying all terms
   - Cache frequently accessed terms
   - Use pagination for large lists
   - Limit depth in hierarchical taxonomies

---

## Additional Resources

- [Taxonomies - WordPress Developer Resources](https://developer.wordpress.org/plugins/taxonomies/)
- [Function Reference: register_taxonomy](https://developer.wordpress.org/reference/functions/register_taxonomy/)
- [Function Reference: get_terms](https://developer.wordpress.org/reference/functions/get_terms/)
- Core Files:
  - `wp-includes/taxonomy.php` - Taxonomy functions
  - `wp-includes/class-wp-taxonomy.php` - WP_Taxonomy class
