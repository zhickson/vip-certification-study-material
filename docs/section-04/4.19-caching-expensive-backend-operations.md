# 4.19 Caching Expensive Backend Operations at the Right Layer - Study Notes

## Overview

Choosing the right caching layer for expensive operations is crucial for performance. Understanding when to use object cache, transients, or page-level caching is essential.

**Key Reference:** [Caching - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/performance/caching/)

---

## 1. Caching Complex Queries

### Object Cache

**For Frequently Accessed:**
```php
function get_expensive_query() {
	$cache_key = 'expensive_query_' . md5( serialize( $args ) );
	$results = wp_cache_get( $cache_key );

	if ( false === $results ) {
		$query = new WP_Query( $args );
		$results = $query->posts;
		wp_cache_set( $cache_key, $results, '', 3600 );
	}

	return $results;
}
```

### Transients

**For Temporary Data:**
```php
function get_expensive_query() {
	$transient_key = 'expensive_query';
	$results = get_transient( $transient_key );

	if ( false === $results ) {
		$query = new WP_Query( $args );
		$results = $query->posts;
		set_transient( $transient_key, $results, HOUR_IN_SECONDS );
	}

	return $results;
}
```

---

## 2. Caching Calculations

### Expensive Calculations

**Cache Results:**
```php
function calculate_expensive_result( $input ) {
	$cache_key = 'calculation_' . md5( $input );
	$result = wp_cache_get( $cache_key );

	if ( false === $result ) {
		// Expensive calculation
		$result = perform_expensive_calculation( $input );
		wp_cache_set( $cache_key, $result, '', 3600 );
	}

	return $result;
}
```

---

## 3. Caching API Results

### API Response Caching

**Cache API Calls:**
```php
function get_api_result() {
	$cache_key = 'api_result';
	$result = get_transient( $cache_key );

	if ( false === $result ) {
		$response = wp_remote_get( 'https://api.example.com/data' );
		$result = json_decode( wp_remote_retrieve_body( $response ), true );
		set_transient( $cache_key, $result, HOUR_IN_SECONDS );
	}

	return $result;
}
```

---

## 4. Choosing the Right Layer

### Object Cache

**Use For:**
- Frequently accessed data
- Short-lived cache (< 1 hour)
- Shared across requests
- With persistent cache enabled

### Transients

**Use For:**
- Temporary data
- Longer expiration (> 1 hour)
- Works without object cache
- API responses

### Page Cache

**Use For:**
- Full page output
- Static content
- User-agnostic content
- CDN caching

---

## 5. Cache Invalidation

### Invalidate on Update

**Clear Cache:**
```php
// Invalidate on post save
add_action( 'save_post', function( $post_id ) {
	wp_cache_delete( 'expensive_query', '' );
	delete_transient( 'expensive_query' );
} );
```

---

## Exam Tips

### Key Points to Remember

1. **Cache Layers:**
   - Object cache: Frequently accessed, short-lived
   - Transients: Temporary data, longer expiration
   - Page cache: Full page output

2. **When to Cache:**
   - Complex queries
   - Expensive calculations
   - API responses
   - Repeated operations

3. **Best Practices:**
   - Choose appropriate layer
   - Set appropriate TTLs
   - Invalidate on updates
   - Monitor cache performance

---

## Additional Resources

- [Caching - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/performance/caching/)
- [Object Cache - WordPress Developer Resources](https://developer.wordpress.org/reference/classes/wp_object_cache/)
- [Transients API - WordPress Developer Resources](https://developer.wordpress.org/apis/handbook/transients/)
