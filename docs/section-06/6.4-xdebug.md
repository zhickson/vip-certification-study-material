# 6.4 Xdebug - Study Notes

## Overview

Xdebug is a PHP extension that provides debugging and profiling capabilities. It allows step-through debugging, breakpoints, variable inspection, and performance profiling for WordPress development.

**Key Reference:** [Xdebug Documentation](https://xdebug.org/docs/)

---

## 1. Setting Breakpoints and Stepping Through Functions

### Installation

**Linux (apt):**
```bash
sudo apt-get install php-xdebug
```

**macOS (Homebrew):**
```bash
brew install php-xdebug
```

**Manual Installation:**
- Download from [xdebug.org](https://xdebug.org/download.php)
- Configure in `php.ini`

### PHP Configuration

**php.ini Settings:**
```ini
[xdebug]
zend_extension=xdebug.so
xdebug.mode=debug
xdebug.start_with_request=yes
xdebug.client_host=127.0.0.1
xdebug.client_port=9003
xdebug.idekey=PHPSTORM
```

### IDE Configuration

**VS Code:**
```json
{
    "name": "Listen for Xdebug",
    "type": "php",
    "request": "launch",
    "port": 9003,
    "pathMappings": {
        "/var/www/html": "${workspaceFolder}"
    }
}
```

**PHPStorm:**
- Settings → Languages & Frameworks → PHP → Debug
- Configure port 9003
- Set path mappings

### Setting Breakpoints

**In IDE:**
- Click line number to set breakpoint
- Red dot indicates breakpoint
- Execution pauses at breakpoint
- Inspect variables and call stack

**Conditional Breakpoints:**
```php
// Break only if condition is true
if ( $user_id === 1 ) {
    // Set breakpoint here
    $debug = true;
}
```

### Stepping Through Code

**Step Controls:**
- **Step Over (F10):** Execute current line, don't enter functions
- **Step Into (F11):** Enter function calls
- **Step Out (Shift+F11):** Exit current function
- **Continue (F5):** Resume execution to next breakpoint

---

## 2. Tracing Function Calls and Execution Order

### Function Call Tracing

**Enable Tracing:**
```ini
xdebug.mode=trace
xdebug.start_with_request=yes
xdebug.trace_output_dir=/tmp/xdebug
xdebug.trace_output_name=trace.%c
```

### Trace File Format

**Example Trace:**
```
TRACE START [2024-01-15 10:30:45]
    0.0001     114112  -> {main}() /var/www/html/index.php:0
    0.0002     114112    -> require() /var/www/html/wp-blog-header.php:13
    0.0003     114112      -> require_once() /var/www/html/wp-load.php:50
    0.0004     114112        -> require_once() /var/www/html/wp-config.php:89
    0.0005     114112          -> require_once() /var/www/html/wp-settings.php:495
    0.0006     114112            -> do_action() /var/www/html/wp-includes/plugin.php:205
    0.0007     114112              -> my_plugin_init() /var/www/html/wp-content/plugins/my-plugin/my-plugin.php:42
```

### Function Call Information

**Trace Data:**
- Function name
- File and line number
- Execution time
- Memory usage
- Parameter values
- Return values

### Analysing Execution Order

**Understanding Call Stack:**
- Shows function call hierarchy
- Identifies execution path
- Reveals plugin/theme interactions
- Helps debug hook execution

---

## 3. Profiling Performance and Memory Usage

### Enable Profiling

**php.ini Configuration:**
```ini
xdebug.mode=profile
xdebug.start_with_request=yes
xdebug.output_dir=/tmp/xdebug
xdebug.profiler_output_name=cachegrind.out.%p
```

### Profiling Output

**Cachegrind Format:**
- Use KCacheGrind or QCacheGrind to view
- Shows function execution time
- Displays call counts
- Identifies bottlenecks

### Memory Profiling

**Memory Usage Information:**
```php
// Xdebug provides memory usage
xdebug_memory_usage();      // Current memory usage
xdebug_peak_memory_usage();  // Peak memory usage
```

### Performance Analysis

**Identifying Slow Functions:**
- Sort by execution time
- Find functions called frequently
- Identify memory-intensive operations
- Optimize hot paths

### WordPress-Specific Profiling

**Profile WordPress Execution:**
```php
// Profile specific WordPress functions
xdebug_start_trace('/tmp/wp-trace');
// WordPress code execution
xdebug_stop_trace();
```

---

## 4. Xdebug Configuration Options

### Debug Mode

**Configuration:**
```ini
xdebug.mode=debug
xdebug.start_with_request=trigger
xdebug.client_host=127.0.0.1
xdebug.client_port=9003
```

**Trigger Options:**
- `yes`: Always start debugging
- `no`: Never start debugging
- `trigger`: Start when XDEBUG_SESSION_START cookie is set

### Coverage Mode

**Code Coverage:**
```ini
xdebug.mode=coverage
```

**Usage:**
```php
xdebug_start_code_coverage();
// Code to test
$coverage = xdebug_get_code_coverage();
xdebug_stop_code_coverage();
```

### Development vs Production

**Development:**
```ini
xdebug.mode=debug,profile,trace
xdebug.start_with_request=yes
```

**Production:**
```ini
; Disable Xdebug in production
; xdebug.mode=off
```

---

## 5. Common Xdebug Issues and Solutions

### Connection Issues

**Problem:** Debugger not connecting

**Solutions:**
- Check firewall settings
- Verify port 9003 is open
- Check `xdebug.client_host` setting
- Verify IDE configuration

### Performance Impact

**Problem:** Xdebug slows down execution

**Solutions:**
- Use `xdebug.start_with_request=trigger` instead of `yes`
- Disable in production
- Use profiling mode only when needed

### Path Mapping Issues

**Problem:** Breakpoints not working

**Solutions:**
- Configure path mappings in IDE
- Match server paths to local paths
- Use absolute paths in configuration

---

## 6. WordPress Debugging with Xdebug

### Debugging Plugins

**Set Breakpoints:**
- In plugin files
- In hook callbacks
- In AJAX handlers
- In REST API endpoints

### Debugging Themes

**Set Breakpoints:**
- In template files
- In functions.php
- In template parts
- In custom functions

### Debugging Core

**Set Breakpoints:**
- In wp-includes files
- In wp-admin files
- In core functions
- In hook execution

### Debugging AJAX

**Remote Debugging:**
- Set breakpoints in AJAX handlers
- Use browser extension to trigger
- Inspect AJAX request data
- Debug response generation

---

## Exam Tips

### Key Points to Remember

1. **Xdebug Features:**
   - Step-through debugging
   - Breakpoints
   - Variable inspection
   - Function call tracing
   - Performance profiling

2. **Configuration:**
   - Enable in php.ini
   - Configure IDE connection
   - Set path mappings
   - Use appropriate mode

3. **Debugging Workflow:**
   - Set breakpoints
   - Step through code
   - Inspect variables
   - Analyse call stack

4. **Performance:**
   - Xdebug slows execution
   - Disable in production
   - Use trigger mode for on-demand debugging
   - Profile only when needed

5. **Best Practices:**
   - Use for complex debugging
   - Combine with error logs
   - Profile performance bottlenecks
   - Disable when not needed

---

## Additional Resources

- [Xdebug Documentation](https://xdebug.org/docs/)
- [Xdebug Installation Guide](https://xdebug.org/docs/install)
- [VS Code PHP Debugging](https://code.visualstudio.com/docs/languages/php)
- [PHPStorm Xdebug Configuration](https://www.jetbrains.com/help/phpstorm/configuring-xdebug.html)
