# 6.8 Request and Response Headers - Study Notes

## Overview

HTTP headers provide crucial information for debugging caching, redirects, and authentication in WordPress. Understanding how to inspect and interpret headers is essential for troubleshooting web application issues.

**Key Reference:** [HTTP Headers - MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)

---

## 1. Inspecting Authentication Headers

### Common Authentication Headers

**Authorization Header:**
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Cookie Header:**
```
Cookie: wordpress_logged_in_abc123=...
```

**X-WP-Nonce Header:**
```
X-WP-Nonce: abc123def456
```

### WordPress Authentication

**REST API Authentication:**
- Application passwords
- Cookie authentication
- OAuth tokens
- Nonce verification

**Inspecting in Browser:**
- Network panel â†’ Request headers
- Look for Authorization header
- Check Cookie header
- Verify X-WP-Nonce header

### Debugging Authentication Issues

**Common Issues:**
- Missing Authorization header
- Expired tokens
- Invalid nonces
- Cookie problems
- CORS issues

**Debugging Steps:**
1. Check request headers
2. Verify token validity
3. Check cookie expiration
4. Verify nonce
5. Check CORS headers

---

## 2. Diagnosing Caching Behaviour

### Cache-Related Headers

**Cache-Control:**
```
Cache-Control: max-age=3600, public
Cache-Control: no-cache, no-store, must-revalidate
```

**ETag:**
```
ETag: "abc123def456"
```

**Last-Modified:**
```
Last-Modified: Wed, 15 Jan 2024 10:30:45 GMT
```

**Vary:**
```
Vary: Accept-Encoding, Cookie
```

### Cache Hit/Miss Indicators

**Cache Hit:**
- Status: 304 Not Modified
- X-Cache: HIT
- Age header present
- Fast response time

**Cache Miss:**
- Status: 200 OK
- X-Cache: MISS
- Full response body
- Slower response time

### WordPress Caching Headers

**WordPress Sets:**
```php
// Set cache headers
header( 'Cache-Control: max-age=3600, public' );
header( 'ETag: ' . md5( $content ) );
header( 'Last-Modified: ' . gmdate( 'D, d M Y H:i:s', $last_modified ) . ' GMT' );
```

**Common Headers:**
- Cache-Control
- Expires
- ETag
- Last-Modified
- Vary

### Debugging Cache Issues

**Check Headers:**
- Verify Cache-Control settings
- Check ETag values
- Verify Last-Modified dates
- Check Vary headers
- Look for cache bypass headers

---

## 3. Tracing Redirect Loops via Headers

### Redirect Headers

**Location Header:**
```
Location: https://example.com/new-url
```

**Status Codes:**
- 301: Permanent redirect
- 302: Temporary redirect
- 307: Temporary redirect (preserve method)
- 308: Permanent redirect (preserve method)

### Identifying Redirect Loops

**Symptoms:**
- Multiple redirects
- Circular redirects
- Browser error: "Too many redirects"
- Status codes: 301/302 in chain

**Tracing:**
1. Open Network panel
2. Enable "Preserve log"
3. Reload page
4. Check redirect chain
5. Identify loop

### Common Causes

**WordPress Redirect Loops:**
- Incorrect site URL
- SSL/HTTPS issues
- Plugin conflicts
- .htaccess problems
- Server configuration

**Debugging:**
```bash
# Check redirect chain with curl
curl -I -L https://example.com

# Follow redirects
curl -v -L https://example.com
```

### Fixing Redirect Loops

**Check wp-config.php:**
```php
define( 'WP_HOME', 'https://example.com' );
define( 'WP_SITEURL', 'https://example.com' );
```

**Check .htaccess:**
```apache
# Verify redirect rules
# Check for conflicting rules
```

---

## 4. Common WordPress Headers

### Security Headers

**X-Content-Type-Options:**
```
X-Content-Type-Options: nosniff
```

**X-Frame-Options:**
```
X-Frame-Options: SAMEORIGIN
```

**X-XSS-Protection:**
```
X-XSS-Protection: 1; mode=block
```

**Content-Security-Policy:**
```
Content-Security-Policy: default-src 'self'
```

### WordPress-Specific Headers

**X-Pingback:**
```
X-Pingback: https://example.com/xmlrpc.php
```

**Link:**
```
Link: <https://example.com/wp-json/>; rel="https://api.w.org/"
```

### Custom Headers

**Adding Custom Headers:**
```php
// Add custom header
header( 'X-Custom-Header: value' );

// Using WordPress hook
add_action( 'send_headers', function() {
    header( 'X-Custom-Header: value' );
} );
```

---

## 5. Inspecting Headers in Different Tools

### Browser DevTools

**Network Panel:**
- View request headers
- View response headers
- Copy headers
- Filter by header

**Steps:**
1. Open DevTools (F12)
2. Go to Network tab
3. Reload page
4. Click request
5. View Headers tab

### cURL

**View Headers:**
```bash
# View response headers
curl -I https://example.com

# View request and response headers
curl -v https://example.com

# Follow redirects
curl -L -I https://example.com
```

### Command Line Tools

**httpie:**
```bash
http -h https://example.com
```

**wget:**
```bash
wget --server-response --spider https://example.com
```

---

## 6. Debugging Common Header Issues

### CORS Issues

**CORS Headers:**
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST
Access-Control-Allow-Headers: Content-Type
```

**Debugging:**
- Check CORS headers in response
- Verify allowed origins
- Check preflight requests
- Verify allowed methods

### Content-Type Issues

**Content-Type Header:**
```
Content-Type: text/html; charset=UTF-8
Content-Type: application/json
```

**Common Issues:**
- Wrong Content-Type
- Missing charset
- Encoding issues

### Compression Issues

**Content-Encoding:**
```
Content-Encoding: gzip
```

**Debugging:**
- Check if compression enabled
- Verify Accept-Encoding header
- Check Content-Encoding response
- Test with/without compression

---

## Exam Tips

### Key Points to Remember

1. **Authentication Headers:**
   - Authorization header for tokens
   - Cookie header for sessions
   - X-WP-Nonce for WordPress
   - Check in Network panel

2. **Cache Headers:**
   - Cache-Control controls caching
   - ETag for validation
   - Last-Modified for validation
   - Check for cache hits/misses

3. **Redirect Headers:**
   - Location header for redirects
   - Status codes indicate type
   - Trace redirect chains
   - Identify loops

4. **Debugging Tools:**
   - Browser DevTools Network panel
   - cURL for command line
   - Check request and response headers
   - Verify header values

5. **Common Issues:**
   - Missing authentication headers
   - Cache not working
   - Redirect loops
   - CORS problems

---

## Additional Resources

- [HTTP Headers - MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
- [cURL Documentation](https://curl.se/docs/)
- [WordPress REST API Authentication](https://developer.wordpress.org/rest-api/using-the-rest-api/authentication/)
