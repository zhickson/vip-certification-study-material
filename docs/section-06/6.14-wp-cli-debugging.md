# 6.14 WP-CLI for Debugging - Study Notes

## Overview

WP-CLI provides command-line tools for managing WordPress, including powerful debugging commands to inspect data, query the database, debug scheduled tasks, and interact with WordPress runtime state.

**Key Reference:** [WP-CLI Handbook](https://wp-cli.org/handbook/)

---

## 1. Common WP-CLI Commands for Debugging

### Option Commands

**Get Option:**
```bash
# Get single option
wp option get siteurl

# Get all options
wp option list

# Get option with format
wp option get active_plugins --format=json
```

**Update Option:**
```bash
# Update option
wp option update my_option "value"

# Update with format
wp option update my_option '{"key":"value"}' --format=json
```

**Delete Option:**
```bash
# Delete option
wp option delete my_option
```

### Database Commands

**Query Database:**
```bash
# Execute SQL query
wp db query "SELECT * FROM wp_posts LIMIT 10"

# Query with format
wp db query "SELECT post_title FROM wp_posts" --format=table

# Export query results
wp db query "SELECT * FROM wp_users" --format=csv > users.csv
```

**Database Information:**
```bash
# Check database connection
wp db check

# Show database size
wp db size

# Show database tables
wp db tables

# Show table structure
wp db describe wp_posts
```

**Database Operations:**
```bash
# Export database
wp db export backup.sql

# Import database
wp db import backup.sql

# Search and replace
wp search-replace 'old-url.com' 'new-url.com'
```

### Cron Commands

**List Cron Events:**
```bash
# List all cron events
wp cron event list

# List with format
wp cron event list --format=table

# List scheduled events
wp cron event list --format=json
```

**Test Cron:**
```bash
# Test cron event
wp cron event run hook_name

# Run all due events
wp cron event run --due-now
```

**Schedule Cron:**
```bash
# Schedule event
wp cron schedule my_hook "+1 hour"

# Delete event
wp cron event delete my_hook
```

---

## 2. Debugging Scheduled Tasks and Runtime State

### Cron Debugging

**Check Cron Status:**
```bash
# List all events
wp cron event list

# Check if cron is disabled
wp cron test

# View cron schedule
wp cron schedule list
```

**Debug Cron Issues:**
```bash
# Run specific event
wp cron event run hook_name

# Run with verbose output
wp cron event run hook_name --debug

# Check event arguments
wp cron event list --format=json | grep hook_name
```

### Runtime State

**Check WordPress Status:**
```bash
# Core version
wp core version

# Check for updates
wp core check-update

# Verify checksums
wp core verify-checksums
```

**Plugin Status:**
```bash
# List plugins
wp plugin list

# Check plugin status
wp plugin status

# Activate/deactivate
wp plugin activate plugin-name
wp plugin deactivate plugin-name
```

**Theme Status:**
```bash
# List themes
wp theme list

# Check active theme
wp theme status
```

### Cache Debugging

**Cache Commands:**
```bash
# Flush cache
wp cache flush

# Delete cache
wp cache delete key group

# Get cache
wp cache get key group
```

---

## 3. Interacting with Database Directly

### Direct SQL Queries

**Query Examples:**
```bash
# Get post count
wp db query "SELECT COUNT(*) FROM wp_posts"

# Get user count
wp db query "SELECT COUNT(*) FROM wp_users"

# Find large options
wp db query "SELECT option_name, LENGTH(option_value) as size FROM wp_options ORDER BY size DESC LIMIT 10"
```

**Complex Queries:**
```bash
# Find posts without featured image
wp db query "SELECT p.ID, p.post_title FROM wp_posts p LEFT JOIN wp_postmeta pm ON p.ID = pm.post_id AND pm.meta_key = '_thumbnail_id' WHERE pm.meta_id IS NULL AND p.post_type = 'post'"

# Find orphaned post meta
wp db query "SELECT pm.meta_id FROM wp_postmeta pm LEFT JOIN wp_posts p ON pm.post_id = p.ID WHERE p.ID IS NULL"
```

### Database Maintenance

**Optimize Tables:**
```bash
# Optimize all tables
wp db optimize

# Optimize specific table
wp db query "OPTIMIZE TABLE wp_posts"
```

**Repair Tables:**
```bash
# Repair all tables
wp db repair

# Repair specific table
wp db query "REPAIR TABLE wp_posts"
```

**Check Tables:**
```bash
# Check all tables
wp db check

# Check specific table
wp db query "CHECK TABLE wp_posts"
```

---

## 4. Advanced Debugging Commands

### User Debugging

**User Commands:**
```bash
# List users
wp user list

# Get user by ID
wp user get 1

# Get user by email
wp user get admin@example.com --field=email

# Create test user
wp user create testuser test@example.com --role=subscriber
```

### Post Debugging

**Post Commands:**
```bash
# List posts
wp post list

# Get post
wp post get 123

# Search posts
wp post list --s="search term"

# List posts by meta
wp post list --meta_key=featured --meta_value=1
```

### Transient Debugging

**Transient Commands:**
```bash
# List transients (requires custom command or direct query)
wp db query "SELECT option_name, option_value FROM wp_options WHERE option_name LIKE '_transient_%'"

# Delete transient
wp transient delete my_transient

# Get transient
wp transient get my_transient
```

---

## 5. Debugging Workflows

### Common Debugging Tasks

**1. Check Site Configuration:**
```bash
wp option get siteurl
wp option get home
wp core version
wp theme list
wp plugin list
```

**2. Debug Database Issues:**
```bash
wp db check
wp db size
wp db query "SHOW TABLE STATUS"
```

**3. Debug Cron Issues:**
```bash
wp cron event list
wp cron test
wp cron event run hook_name
```

**4. Debug Cache Issues:**
```bash
wp cache flush
wp cache get key group
```

**5. Debug Performance:**
```bash
wp db query "SHOW PROCESSLIST"
wp db size
wp option list --search="autoload"
```

---

## Exam Tips

### Key Points to Remember

1. **Option Commands:**
   - `wp option get` - Get option value
   - `wp option update` - Update option
   - `wp option delete` - Delete option
   - `wp option list` - List all options

2. **Database Commands:**
   - `wp db query` - Execute SQL
   - `wp db export` - Export database
   - `wp db import` - Import database
   - `wp db check` - Check database

3. **Cron Commands:**
   - `wp cron event list` - List events
   - `wp cron event run` - Run event
   - `wp cron test` - Test cron
   - `wp cron schedule` - Schedule event

4. **Debugging:**
   - Use `--format=json` for structured output
   - Use `--debug` for verbose output
   - Combine commands for complex debugging
   - Use direct SQL for advanced queries

5. **Best Practices:**
   - Always backup before database operations
   - Use `--dry-run` when available
   - Test commands in staging first
   - Document complex queries

---

## Additional Resources

- [WP-CLI Handbook](https://wp-cli.org/handbook/)
- [WP-CLI Commands](https://wp-cli.org/commands/)
- [WP-CLI Database Commands](https://wp-cli.org/commands/db/)
- [WP-CLI Cron Commands](https://wp-cli.org/commands/cron/)
