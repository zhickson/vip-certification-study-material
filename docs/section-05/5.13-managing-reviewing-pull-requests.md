# 5.13 Managing and Reviewing Pull Requests - Study Notes

## Overview

Effective pull request management ensures code quality, maintains standards, and facilitates collaboration. This includes conducting reviews, enforcing standards, and providing constructive feedback.

**Key Reference:** [Code Review - GitHub Guides](https://guides.github.com/activities/peer-review/)

---

## 1. Conducting Peer Reviews Effectively

### Review Checklist

```markdown
# Pull Request Review Checklist

## Code Quality
- [ ] Code follows WordPress coding standards
- [ ] Functions are well-documented
- [ ] No obvious bugs or errors
- [ ] Error handling is appropriate
- [ ] Security best practices followed

## Functionality
- [ ] Feature works as described
- [ ] Edge cases handled
- [ ] Backward compatibility maintained
- [ ] No breaking changes (or documented)

## Testing
- [ ] Tests included/updated
- [ ] Tests pass
- [ ] Manual testing completed
- [ ] No regressions introduced

## Documentation
- [ ] Code comments clear
- [ ] README updated if needed
- [ ] Changelog updated
- [ ] User-facing docs updated
```

### Review Process

```markdown
# Review Steps

1. **Understand the Change**
   - Read PR description
   - Review related issues
   - Understand context

2. **Code Review**
   - Check code quality
   - Verify functionality
   - Check security
   - Review tests

3. **Provide Feedback**
   - Be constructive
   - Be specific
   - Suggest improvements
   - Approve or request changes

4. **Follow Up**
   - Review responses
   - Verify fixes
   - Approve when ready
```

### Constructive Feedback

```markdown
# Good Feedback Examples

## ✅ Constructive
"This function could be simplified by extracting the validation logic into a separate function. This would improve testability."

"Consider using `wp_prepare_attachment_for_js()` instead of manually building the response array. It handles edge cases better."

## ❌ Not Constructive
"This is wrong."
"Fix this."
"Bad code."
```

---

## 2. Enforcing Coding Standards with CI Checks

### PHPCS Integration

```yaml
# .github/workflows/phpcs.yml
name: PHPCS

on: [pull_request]

jobs:
  phpcs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.0'

      - name: Install PHPCS
        run: |
          composer require --dev wp-coding-standards/wpcs
          ./vendor/bin/phpcs --config-set installed_paths vendor/wp-coding-standards/wpcs

      - name: Run PHPCS
        run: ./vendor/bin/phpcs --standard=WordPress src/
```

### Automated Code Review

```yaml
# .github/workflows/code-review.yml
name: Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run PHPCS
        run: ./vendor/bin/phpcs --standard=WordPress src/
        continue-on-error: true

      - name: Run PHPStan
        run: ./vendor/bin/phpstan analyse
        continue-on-error: true

      - name: Comment PR
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'Code review checks completed. Please address any issues.'
            })
```

### Required Status Checks

```yaml
# Branch protection requires these checks
# Settings → Branches → Add rule

Required status checks:
- PHPCS
- PHPStan
- Unit Tests
- Integration Tests
```

---

## 3. Providing Clear Documentation in PRs

### PR Template

```markdown
# Pull Request Template

## Description
Brief description of changes

## Type of Change
- [ ] Bug fix (non-breaking change)
- [ ] New feature (non-breaking change)
- [ ] Breaking change
- [ ] Documentation update

## Related Issues
Closes #123
Related to #456

## Changes Made
- Added user authentication
- Updated admin interface
- Fixed login bug

## Testing
- [ ] Unit tests added/updated
- [ ] Integration tests pass
- [ ] Manual testing completed
- [ ] Tested in staging

## Screenshots (if applicable)
![Screenshot](url)

## Checklist
- [ ] Code follows WordPress standards
- [ ] Documentation updated
- [ ] No security issues
- [ ] Backward compatible
- [ ] Changelog updated
```

### Good PR Description

```markdown
## Problem
Users cannot reset their passwords, causing support tickets.

## Solution
Added password reset functionality with email verification.

## Changes
- Added password reset form
- Implemented email sending
- Added reset token validation
- Updated user password on reset

## Testing
- Tested password reset flow
- Verified email delivery
- Tested token expiration
- Tested invalid token handling

## Screenshots
[Include screenshots of new functionality]
```

---

## 4. Communicating Feedback Constructively

### Feedback Guidelines

```markdown
# Feedback Best Practices

## Be Specific
❌ "This is wrong"
✅ "The `sanitize_text_field()` function should be used here instead of `strip_tags()` to properly sanitize user input."

## Explain Why
❌ "Change this"
✅ "Using `wp_prepare_attachment_for_js()` here would be better because it handles all edge cases and is the WordPress-recommended approach."

## Suggest Solutions
❌ "This won't work"
✅ "Consider using `get_transient()` with a fallback to handle cases where the transient doesn't exist."

## Be Respectful
❌ "This is terrible code"
✅ "I think we could improve this by extracting the validation logic into a separate function for better testability."
```

### Review Comments

```markdown
# Inline Comments

## Suggestion
```php
// Consider using wp_prepare_attachment_for_js() here
$attachment = get_post( $attachment_id );
```

## Question
```php
// Why is this check needed? Could we handle this differently?
if ( ! $user ) {
    return false;
}
```

## Approval
```php
// ✅ Looks good! This handles the edge case well.
if ( ! $user || ! $user->has_cap( 'edit_posts' ) ) {
    return false;
}
```
```

---

## 5. PR Review Workflow

### Review States

```markdown
# PR States

1. **Draft** - Work in progress
2. **Ready for Review** - Ready to be reviewed
3. **Changes Requested** - Needs fixes
4. **Approved** - Ready to merge
5. **Merged** - Completed
```

### Review Process

```bash
# 1. Author creates PR
# 2. CI checks run automatically
# 3. Reviewers assigned
# 4. Reviewers provide feedback
# 5. Author addresses feedback
# 6. Reviewers re-review
# 7. Approved and merged
```

### Review Assignment

```yaml
# Auto-assign reviewers
# .github/workflows/assign-reviewers.yml
name: Assign Reviewers

on:
  pull_request:
    types: [opened]

jobs:
  assign:
    runs-on: ubuntu-latest
    steps:
      - name: Assign reviewers
        uses: kentaro-m/auto-assign-action@v1
        with:
          reviewers: team-lead, senior-dev
          number-of-reviewers: 2
```

---

## 6. Best Practices

### For Authors

- Write clear PR descriptions
- Keep PRs small and focused
- Respond to feedback promptly
- Update PR based on feedback
- Test thoroughly before submitting

### For Reviewers

- Review promptly
- Be constructive and respectful
- Focus on code, not person
- Explain reasoning
- Approve when ready

### For Teams

- Establish review guidelines
- Use PR templates
- Enforce coding standards
- Require approvals
- Track review metrics

---

## Exam Tips

### Key Points to Remember

1. **Review Process:**
   - Understand the change
   - Check code quality
   - Verify functionality
   - Provide feedback

2. **CI Integration:**
   - Automated code checks
   - Required status checks
   - Enforce standards

3. **Documentation:**
   - Clear PR descriptions
   - Use templates
   - Include testing info

4. **Feedback:**
   - Be constructive
   - Be specific
   - Suggest solutions
   - Be respectful

5. **Workflow:**
   - Draft → Review → Changes → Approved → Merged
   - Assign reviewers
   - Require approvals

---

## Additional Resources

- [Code Review - GitHub Guides](https://guides.github.com/activities/peer-review/)
- [Pull Request Best Practices](https://github.com/blog/1943-how-to-write-the-perfect-pull-request)
- [Code Review Guidelines](https://google.github.io/eng-practices/review/)
