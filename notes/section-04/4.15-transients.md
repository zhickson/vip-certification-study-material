# 4.15 Transients - Study Notes

## Overview

Transients provide temporary data storage with expiration. Understanding how transients behave with and without persistent object caching is crucial for WordPress performance.

**Key Reference:** [Transients API - WordPress Developer Resources](https://developer.wordpress.org/apis/handbook/transients/)

---

## 1. Transients with Persistent Cache

### How Transients Work with Object Cache

**With Persistent Cache (Redis/Memcached):**
- Stored in object cache
- Fast retrieval
- Shared across processes
- Automatic expiration

**Implementation:**
```53:89:wordpress/wp-includes/option.php
	if ( wp_using_ext_object_cache() || wp_installing() ) {
		$result = wp_cache_set( $transient, $value, 'transient', $expiration );
	} else {
		$transient_timeout = '_transient_timeout_' . $transient;
		$transient_option  = '_transient_' . $transient;
		wp_prime_option_caches( array( $transient_option, $transient_timeout ) );

		if ( false === get_option( $transient_option ) ) {
			$autoload = true;
			if ( $expiration ) {
				$autoload = false;
				add_option( $transient_timeout, time() + $expiration, '', false );
			}
			$result = add_option( $transient_option, $value, '', $autoload );
		} else {
			/*
			 * If expiration is requested, but the transient has no timeout option,
			 * delete, then re-create transient rather than update.
			 */
			$update = true;

			if ( $expiration ) {
				if ( false === get_option( $transient_timeout ) ) {
					delete_option( $transient_option );
					add_option( $transient_timeout, time() + $expiration, '', false );
					$result = add_option( $transient_option, $value, '', false );
					$update = false;
				} else {
					update_option( $transient_timeout, time() + $expiration );
				}
			}

			if ( $update ) {
				$result = update_option( $transient_option, $value );
			}
		}
	}
```

**Benefits:**
- Very fast
- No database queries
- Automatic expiration
- Shared across servers

---

## 2. Transients without Persistent Cache

### Database Storage

**Without Object Cache:**
- Stored in `wp_options` table
- Requires database query
- Slower than object cache
- Expiration checked on retrieval

**Storage:**
```php
// Stored as options
// _transient_timeout_{name} - Expiration time
// _transient_{name} - Actual value
```

**Retrieval:**
```php
// Checks expiration on retrieval
$value = get_transient( 'my_transient' );
// If expired, deletes and returns false
```

### Limitations

**Issues:**
- Database queries required
- Slower than object cache
- Can accumulate expired transients
- Requires manual cleanup

---

## 3. Using Transients Appropriately

### When to Use Transients

**Good Use Cases:**
- API response caching
- Expensive calculations
- External data fetching
- Temporary data storage

**Example:**
```php
// âœ… GOOD - Cache API response
function get_api_data() {
	$data = get_transient( 'api_data' );

	if ( false === $data ) {
		$response = wp_remote_get( 'https://api.example.com/data' );
		$data = json_decode( wp_remote_retrieve_body( $response ), true );
		set_transient( 'api_data', $data, HOUR_IN_SECONDS );
	}

	return $data;
}
```

### Expiration Times

**WordPress Time Constants:**
```php
MINUTE_IN_SECONDS = 60
HOUR_IN_SECONDS = 3600
DAY_IN_SECONDS = 86400
WEEK_IN_SECONDS = 604800
MONTH_IN_SECONDS = 2592000
YEAR_IN_SECONDS = 31536000
```

**Usage:**
```php
// Set expiration
set_transient( 'data', $value, HOUR_IN_SECONDS );
set_transient( 'data', $value, 2 * HOUR_IN_SECONDS );
set_transient( 'data', $value, DAY_IN_SECONDS );
```

---

## Exam Tips

### Key Points to Remember

1. **With Persistent Cache:**
   - Stored in object cache
   - Very fast
   - No database queries
   - Automatic expiration

2. **Without Persistent Cache:**
   - Stored in database
   - Requires queries
   - Slower
   - Expiration checked on retrieval

3. **Best Practices:**
   - Use for temporary data
   - Set appropriate expiration
   - Use for API caching
   - Clean up expired transients

4. **WordPress Functions:**
   - `set_transient()` - Set transient
   - `get_transient()` - Get transient
   - `delete_transient()` - Delete transient

5. **Performance:**
   - Much faster with object cache
   - Consider object cache for production
   - Monitor transient usage

---

## Additional Resources

- [Transients API - WordPress Developer Resources](https://developer.wordpress.org/apis/handbook/transients/)
- Core Files:
  - `wp-includes/option.php` - Transient functions
