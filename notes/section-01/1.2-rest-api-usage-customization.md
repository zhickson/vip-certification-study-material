# 1.2 Core REST API Usage and Customization - Study Notes

## Overview

The WordPress REST API provides a standardised way to interact with WordPress data programmatically. It enables CRUD operations on posts, users, comments, and other WordPress objects via HTTP requests. Understanding authentication, validation, and extension methods is essential for secure and effective API usage.

**Key Reference:** [REST API Handbook - WordPress Developer Resources](https://developer.wordpress.org/rest-api/)

---

## 1. Using Core Endpoints for CRUD Operations

### Core Endpoints Overview

WordPress registers default REST API routes for all post types, taxonomies, users, comments, and other core objects. The base URL is `/wp-json/wp/v2/`.

**Core Implementation:**
```265:290:wordpress/wp-includes/rest-api.php
function create_initial_rest_routes() {
	foreach ( get_post_types( array( 'show_in_rest' => true ), 'objects' ) as $post_type ) {
		$controller = $post_type->get_rest_controller();

		if ( ! $controller ) {
			continue;
		}

		if ( ! $post_type->late_route_registration ) {
			$controller->register_routes();
		}

		$revisions_controller = $post_type->get_revisions_rest_controller();
		if ( $revisions_controller ) {
			$revisions_controller->register_routes();
		}

		$autosaves_controller = $post_type->get_autosave_rest_controller();
		if ( $autosaves_controller ) {
			$autosaves_controller->register_routes();
		}

		if ( $post_type->late_route_registration ) {
			$controller->register_routes();
		}
	}
```

### Common Core Endpoints

#### Posts
- **GET** `/wp-json/wp/v2/posts` - List posts
- **GET** `/wp-json/wp/v2/posts/{id}` - Get single post
- **POST** `/wp-json/wp/v2/posts` - Create post
- **PUT/PATCH** `/wp-json/wp/v2/posts/{id}` - Update post
- **DELETE** `/wp-json/wp/v2/posts/{id}` - Delete post

#### Users
- **GET** `/wp-json/wp/v2/users` - List users
- **GET** `/wp-json/wp/v2/users/{id}` - Get single user
- **POST** `/wp-json/wp/v2/users` - Create user
- **PUT/PATCH** `/wp-json/wp/v2/users/{id}` - Update user
- **DELETE** `/wp-json/wp/v2/users/{id}` - Delete user

#### Comments
- **GET** `/wp-json/wp/v2/comments` - List comments
- **GET** `/wp-json/wp/v2/comments/{id}` - Get single comment
- **POST** `/wp-json/wp/v2/comments` - Create comment
- **PUT/PATCH** `/wp-json/wp/v2/comments/{id}` - Update comment
- **DELETE** `/wp-json/wp/v2/comments/{id}` - Delete comment

#### Taxonomies and Terms
- **GET** `/wp-json/wp/v2/categories` - List categories
- **GET** `/wp-json/wp/v2/tags` - List tags
- **GET** `/wp-json/wp/v2/categories/{id}` - Get single category

### Route Registration Pattern

**Core Implementation:**
```73:150:wordpress/wp-includes/rest-api/endpoints/class-wp-rest-posts-controller.php
	public function register_routes() {

		register_rest_route(
			$this->namespace,
			'/' . $this->rest_base,
			array(
				array(
					'methods'             => WP_REST_Server::READABLE,
					'callback'            => array( $this, 'get_items' ),
					'permission_callback' => array( $this, 'get_items_permissions_check' ),
					'args'                => $this->get_collection_params(),
				),
				array(
					'methods'             => WP_REST_Server::CREATABLE,
					'callback'            => array( $this, 'create_item' ),
					'permission_callback' => array( $this, 'create_item_permissions_check' ),
					'args'                => $this->get_endpoint_args_for_item_schema( WP_REST_Server::CREATABLE ),
				),
				'allow_batch' => $this->allow_batch,
				'schema'      => array( $this, 'get_public_item_schema' ),
			)
		);

		$schema        = $this->get_item_schema();
		$get_item_args = array(
			'context' => $this->get_context_param( array( 'default' => 'view' ) ),
		);
		if ( isset( $schema['properties']['excerpt'] ) ) {
			$get_item_args['excerpt_length'] = array(
				'description' => __( 'Override the default excerpt length.' ),
				'type'        => 'integer',
			);
		}
		if ( isset( $schema['properties']['password'] ) ) {
			$get_item_args['password'] = array(
				'description' => __( 'The password for the post if it is password protected.' ),
				'type'        => 'string',
			);
		}
		register_rest_route(
			$this->namespace,
			'/' . $this->rest_base . '/(?P<id>[\d]+)',
			array(
				'args'        => array(
					'id' => array(
						'description' => __( 'Unique identifier for the post.' ),
						'type'        => 'integer',
					),
				),
				array(
					'methods'             => WP_REST_Server::READABLE,
					'callback'            => array( $this, 'get_item' ),
					'permission_callback' => array( $this, 'get_item_permissions_check' ),
					'args'                => $get_item_args,
				),
				array(
					'methods'             => WP_REST_Server::EDITABLE,
					'callback'            => array( $this, 'update_item' ),
					'permission_callback' => array( $this, 'update_item_permissions_check' ),
					'args'                => $this->get_endpoint_args_for_item_schema( WP_REST_Server::EDITABLE ),
				),
				array(
					'methods'             => WP_REST_Server::DELETABLE,
					'callback'            => array( $this, 'delete_item' ),
					'permission_callback' => array( $this, 'delete_item_permissions_check' ),
					'args'                => array(
						'force' => array(
							'type'        => 'boolean',
							'default'     => false,
							'description' => __( 'Whether to bypass Trash and force deletion.' ),
						),
					),
				),
				'allow_batch' => $this->allow_batch,
				'schema'      => array( $this, 'get_public_item_schema' ),
			)
		);
	}
```

### Example: CRUD Operations

#### Create a Post
```php
// Using wp_remote_post()
$response = wp_remote_post( 'https://example.com/wp-json/wp/v2/posts', array(
	'headers' => array(
		'Authorization' => 'Basic ' . base64_encode( 'username:application_password' ),
		'Content-Type'  => 'application/json',
	),
	'body' => wp_json_encode( array(
		'title'   => 'My New Post',
		'content' => 'Post content here',
		'status'  => 'publish',
	) ),
) );
```

#### Read Posts
```php
// Using wp_remote_get()
$response = wp_remote_get( 'https://example.com/wp-json/wp/v2/posts?per_page=10' );
$posts = json_decode( wp_remote_retrieve_body( $response ), true );
```

#### Update a Post
```php
$response = wp_remote_request( 'https://example.com/wp-json/wp/v2/posts/123', array(
	'method'  => 'PUT',
	'headers' => array(
		'Authorization' => 'Basic ' . base64_encode( 'username:application_password' ),
		'Content-Type'  => 'application/json',
	),
	'body' => wp_json_encode( array(
		'title' => 'Updated Title',
	) ),
) );
```

#### Delete a Post
```php
$response = wp_remote_request( 'https://example.com/wp-json/wp/v2/posts/123', array(
	'method'  => 'DELETE',
	'headers' => array(
		'Authorization' => 'Basic ' . base64_encode( 'username:application_password' ),
	),
) );
```

**Reference:** [REST API Reference - WordPress Developer Resources](https://developer.wordpress.org/rest-api/reference/)

---

## 2. Authentication Methods

WordPress REST API supports multiple authentication methods. The API attempts authentication in this order: Application Passwords, OAuth, then Cookie Authentication.

### Cookie Authentication

Cookie authentication uses WordPress login cookies and nonces. It's primarily used for authenticated requests from the same domain (e.g., admin AJAX).

**Core Implementation:**
```1108:1152:wordpress/wp-includes/rest-api.php
function rest_cookie_check_errors( $result ) {
	if ( ! empty( $result ) ) {
		return $result;
	}

	global $wp_rest_auth_cookie;

	/*
	 * Is cookie authentication being used? (If we get an auth
	 * error, but we're still logged in, another authentication
	 * must have been used).
	 */
	if ( true !== $wp_rest_auth_cookie && is_user_logged_in() ) {
		return $result;
	}

	// Determine if there is a nonce.
	$nonce = null;

	if ( isset( $_REQUEST['_wpnonce'] ) ) {
		$nonce = $_REQUEST['_wpnonce'];
	} elseif ( isset( $_SERVER['HTTP_X_WP_NONCE'] ) ) {
		$nonce = $_SERVER['HTTP_X_WP_NONCE'];
	}

	if ( null === $nonce ) {
		// No nonce at all, so act as if it's an unauthenticated request.
		wp_set_current_user( 0 );
		return true;
	}

	// Check the nonce.
	$result = wp_verify_nonce( $nonce, 'wp_rest' );

	if ( ! $result ) {
		add_filter( 'rest_send_nocache_headers', '__return_true', 20 );
		return new WP_Error( 'rest_cookie_invalid_nonce', __( 'Cookie check failed' ), array( 'status' => 403 ) );
	}

	// Send a refreshed nonce in header.
	rest_get_server()->send_header( 'X-WP-Nonce', wp_create_nonce( 'wp_rest' ) );

	return true;
}
```

**Usage Example:**
```php
// In JavaScript (same domain)
fetch( '/wp-json/wp/v2/posts', {
	method: 'POST',
	headers: {
		'Content-Type': 'application/json',
		'X-WP-Nonce': wpApiSettings.nonce, // From wp_localize_script
	},
	credentials: 'same-origin', // Include cookies
	body: JSON.stringify( {
		title: 'New Post',
		status: 'publish',
	} ),
} );
```

**Important:** Cookie authentication only works for same-origin requests. For cross-origin requests, use Application Passwords or OAuth.

### Application Passwords

Application Passwords (WP 5.6+) allow users to generate unique passwords for API access without exposing their main account password. They use HTTP Basic Authentication.

**Core Implementation:**
```372:511:wordpress/wp-includes/user.php
function wp_authenticate_application_password(
	$input_user,
	$username,
	#[\SensitiveParameter]
	$password
) {
	if ( $input_user instanceof WP_User ) {

	}

	if ( ! WP_Application_Passwords::is_in_use() ) {
		return $input_user;
	}

	// The 'REST_REQUEST' check here may happen too early for the constant to be available.
	$is_api_request = ( ( defined( 'XMLRPC_REQUEST' ) && XMLRPC_REQUEST ) || ( defined( 'REST_REQUEST' ) && REST_REQUEST ) );

	/**
	 * Filters whether this is an API request that Application Passwords can be used on.
	 *
	 * By default, Application Passwords is available for the REST API and XML-RPC.
	 *
	 * @since 5.6.0
	 *
	 * @param bool $is_api_request If this is an acceptable API request.
	 */
	$is_api_request = apply_filters( 'application_password_is_api_request', $is_api_request );

	if ( ! $is_api_request ) {
		return $input_user;
	}

	$error = null;
	$user  = get_user_by( 'login', $username );

	if ( ! $user && is_email( $username ) ) {
		$user = get_user_by( 'email', $username );
	}

	// If the login name is invalid, short circuit.
	if ( ! $user ) {
		if ( is_email( $username ) ) {
			$error = new WP_Error(
				'invalid_email',
				__( '<strong>Error:</strong> Unknown email address. Check again or try your username.' )
			);
		} else {
			$error = new WP_Error(
				'invalid_username',
				__( '<strong>Error:</strong> Unknown username. Check again or try your email address.' )
			);
		}
	} elseif ( ! wp_is_application_passwords_available() ) {
		$error = new WP_Error(
			'application_passwords_disabled',
			__( 'Application passwords are not available.' )
		);
	} elseif ( ! wp_is_application_passwords_available_for_user( $user ) ) {
		$error = new WP_Error(
			'application_passwords_disabled_for_user',
			__( 'Application passwords are not available for your account. Please contact the site administrator for assistance.' )
		);
	}

	if ( $error ) {
		/**
		 * Fires when an application password failed to authenticate the user.
```

**Usage Example:**
```php
// Generate application password in admin: Users > Profile > Application Passwords
// Then use in requests:

$response = wp_remote_get( 'https://example.com/wp-json/wp/v2/posts', array(
	'headers' => array(
		'Authorization' => 'Basic ' . base64_encode( 'username:application_password_here' ),
	),
) );

// Or with cURL
$ch = curl_init();
curl_setopt( $ch, CURLOPT_URL, 'https://example.com/wp-json/wp/v2/posts' );
curl_setopt( $ch, CURLOPT_USERPWD, 'username:application_password_here' );
curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );
$response = curl_exec( $ch );
```

**Security Notes:**
- Application passwords are stored as hashed values
- They can be revoked individually
- They work for REST API and XML-RPC
- They require the user to have permission to use application passwords

### OAuth Authentication

OAuth 1.0a is supported via plugins (e.g., OAuth 1.0a Server). WordPress core does not include OAuth by default, but the REST API is designed to support OAuth authentication.

**Important:** OAuth requires a plugin. Core WordPress does not provide OAuth endpoints.

**Reference:** [REST API Authentication - WordPress Developer Resources](https://developer.wordpress.org/rest-api/using-the-rest-api/authentication/)

---

## 3. Validation and Sanitization for Requests

All REST API requests must validate and sanitize input data. WordPress provides built-in validation and sanitization through the request schema.

### Request Validation Flow

**Core Implementation:**
```815:875:wordpress/wp-includes/rest-api/class-wp-rest-request.php
	public function sanitize_params() {
		$attributes = $this->get_attributes();

		// No arguments set, skip sanitizing.
		if ( empty( $attributes['args'] ) ) {
			return true;
		}

		$order = $this->get_parameter_order();

		$invalid_params  = array();
		$invalid_details = array();

		foreach ( $order as $type ) {
			if ( empty( $this->params[ $type ] ) ) {
				continue;
			}

			foreach ( $this->params[ $type ] as $key => $value ) {
				if ( ! isset( $attributes['args'][ $key ] ) ) {
					continue;
				}

				$param_args = $attributes['args'][ $key ];

				// If the arg has a type but no sanitize_callback attribute, default to rest_parse_request_arg.
				if ( ! array_key_exists( 'sanitize_callback', $param_args ) && ! empty( $param_args['type'] ) ) {
					$param_args['sanitize_callback'] = 'rest_parse_request_arg';
				}
				// If there's still no sanitize_callback, nothing to do here.
				if ( empty( $param_args['sanitize_callback'] ) ) {
					continue;
				}

				/** @var mixed|WP_Error $sanitized_value */
				$sanitized_value = call_user_func( $param_args['sanitize_callback'], $value, $this, $key );

				if ( is_wp_error( $sanitized_value ) ) {
					$invalid_params[ $key ]  = implode( ' ', $sanitized_value->get_error_messages() );
					$invalid_details[ $key ] = rest_convert_error_to_response( $sanitized_value )->get_data();
				} else {
					$this->params[ $type ][ $key ] = $sanitized_value;
				}
			}
		}

		if ( $invalid_params ) {
			return new WP_Error(
				'rest_invalid_param',
				/* translators: %s: List of invalid parameters. */
				sprintf( __( 'Invalid parameter(s): %s' ), implode( ', ', array_keys( $invalid_params ) ) ),
				array(
					'status'  => 400,
					'params'  => $invalid_params,
					'details' => $invalid_details,
				)
			);
		}

		return true;
	}
```

**Validation Implementation:**
```885:970:wordpress/wp-includes/rest-api/class-wp-rest-request.php
	public function has_valid_params() {
		// If JSON data was passed, check for errors.
		$json_error = $this->parse_json_params();
		if ( is_wp_error( $json_error ) ) {
			return $json_error;
		}

		$attributes = $this->get_attributes();
		$required   = array();

		$args = empty( $attributes['args'] ) ? array() : $attributes['args'];

		foreach ( $args as $key => $arg ) {
			$param = $this->get_param( $key );
			if ( isset( $arg['required'] ) && true === $arg['required'] && null === $param ) {
				$required[] = $key;
			}
		}

		if ( ! empty( $required ) ) {
			return new WP_Error(
				'rest_missing_callback_param',
				/* translators: %s: List of required parameters. */
				sprintf( __( 'Missing parameter(s): %s' ), implode( ', ', $required ) ),
				array(
					'status' => 400,
					'params' => $required,
				)
			);
		}

		/*
		 * Check the validation callbacks for each registered arg.
		 *
		 * This is done after required checking as required checking is cheaper.
		 */
		$invalid_params  = array();
		$invalid_details = array();

		foreach ( $args as $key => $arg ) {

			$param = $this->get_param( $key );

			if ( null !== $param && ! empty( $arg['validate_callback'] ) ) {
				/** @var bool|\WP_Error $valid_check */
				$valid_check = call_user_func( $arg['validate_callback'], $param, $this, $key );

				if ( false === $valid_check ) {
					$invalid_params[ $key ] = __( 'Invalid parameter.' );
				}

				if ( is_wp_error( $valid_check ) ) {
					$invalid_params[ $key ]  = implode( ' ', $valid_check->get_error_messages() );
					$invalid_details[ $key ] = rest_convert_error_to_response( $valid_check )->get_data();
				}
			}
		}

		if ( $invalid_params ) {

				'rest_invalid_param',
				/* translators: %s: List of invalid parameters. */
				sprintf( __( 'Invalid parameter(s): %s' ), implode( ', ', array_keys( $invalid_params ) ) ),
				array(
					'status'  => 400,
					'params'  => $invalid_params,
					'details' => $invalid_details,
				)
			);
		}

		if ( isset( $attributes['validate_callback'] ) ) {
			$valid_check = call_user_func( $attributes['validate_callback'], $this );

			if ( is_wp_error( $valid_check ) ) {
				return $valid_check;
			}

			if ( false === $valid_check ) {
				// A WP_Error instance is preferred, but false is supported for parity with the per-arg validate_callback.
				return new WP_Error( 'rest_invalid_params', __( 'Invalid parameters.' ), array( 'status' => 400 ) );
			}
		}

		return true;
	}
```

### Registering Validated Arguments

When creating custom endpoints, always define validation and sanitization:

```php
register_rest_route( 'myplugin/v1', '/posts', array(
	'methods'             => WP_REST_Server::CREATABLE,
	'callback'            => 'my_create_post',
	'permission_callback' => 'my_check_permission',
	'args'                => array(
		'title'   => array(
			'required'          => true,
			'type'              => 'string',
			'sanitize_callback' => 'sanitize_text_field',
			'validate_callback' => function( $value, $request, $param ) {
				if ( strlen( $value ) < 3 ) {
					return new WP_Error(
						'rest_invalid_param',
						__( 'Title must be at least 3 characters.' ),
						array( 'status' => 400 )
					);
				}
				return true;
			},
		),
		'email'   => array(
			'required'          => true,
			'type'              => 'string',
			'format'            => 'email',
			'sanitize_callback' => 'sanitize_email',
			'validate_callback' => 'is_email',
		),
		'status'  => array(
			'type'              => 'string',
			'enum'              => array( 'draft', 'publish', 'private' ),
			'default'           => 'draft',
			'sanitize_callback' => 'sanitize_key',
		),
		'count'   => array(
			'type'              => 'integer',
			'minimum'           => 1,
			'maximum'           => 100,
			'default'           => 10,
			'sanitize_callback' => 'absint',
		),
	),
) );
```

### Built-in Validation Functions

WordPress provides validation helpers:

```php
// Core validation functions
rest_validate_request_arg( $value, $request, $param );
rest_sanitize_request_arg( $value, $request, $param );
rest_parse_request_arg( $value, $request, $param ); // Validates then sanitizes
```

**Core Implementation:**
```1474:1484:wordpress/wp-includes/rest-api.php
function rest_parse_request_arg( $value, $request, $param ) {
	$is_valid = rest_validate_request_arg( $value, $request, $param );

	if ( is_wp_error( $is_valid ) ) {
		return $is_valid;
	}

	$value = rest_sanitize_request_arg( $value, $request, $param );

	return $value;
}
```

### Schema Types and Formats

Supported types: `string`, `number`, `integer`, `boolean`, `array`, `object`, `null`

Supported formats: `date-time`, `email`, `uri`, `hex-color`, `ip`, `uuid`

**Example:**
```php
'args' => array(
	'published_date' => array(
		'type'   => 'string',
		'format' => 'date-time',
	),
	'website'       => array(
		'type'   => 'string',
		'format' => 'uri',
	),
),
```

**Reference:** [REST API Handbook - Adding Arguments](https://developer.wordpress.org/rest-api/extending-the-rest-api/adding-custom-endpoints/#arguments)

---

## 4. Extending Core Endpoints

### Adding Custom Fields to Existing Endpoints

Use `register_rest_field()` to add custom fields to existing endpoints (posts, users, comments, terms).

**Core Implementation:**
```182:198:wordpress/wp-includes/rest-api.php
function register_rest_field( $object_type, $attribute, $args = array() ) {
	global $wp_rest_additional_fields;

	$defaults = array(
		'get_callback'    => null,
		'update_callback' => null,
		'schema'          => null,
	);

	$args = wp_parse_args( $args, $defaults );

	$object_types = (array) $object_type;

	foreach ( $object_types as $object_type ) {
		$wp_rest_additional_fields[ $object_type ][ $attribute ] = $args;
	}
}
```

**Example: Adding Custom Field to Posts**
```php
add_action( 'rest_api_init', 'register_custom_rest_fields' );

function register_custom_rest_fields() {
	register_rest_field(
		'post', // Object type
		'custom_rating', // Field name
		array(
			'get_callback'    => function( $object, $field_name, $request ) {
				return get_post_meta( $object['id'], $field_name, true );
			},
			'update_callback' => function( $value, $object, $field_name ) {
				if ( ! is_numeric( $value ) || $value < 1 || $value > 5 ) {
					return new WP_Error(
						'rest_invalid_field',
						__( 'Rating must be between 1 and 5.' ),
						array( 'status' => 400 )
					);
				}
				return update_post_meta( $object->ID, $field_name, absint( $value ) );
			},
			'schema'          => array(
				'description' => __( 'Custom rating field.' ),
				'type'        => 'integer',
				'context'     => array( 'view', 'edit' ),
			),
		)
	);
}
```

**Example: Adding Field to Multiple Object Types**
```php
register_rest_field(
	array( 'post', 'page' ), // Multiple object types
	'featured_image_url',
	array(
		'get_callback' => function( $object ) {
			$image_id = get_post_thumbnail_id( $object['id'] );
			return $image_id ? wp_get_attachment_image_url( $image_id, 'large' ) : null;
		},
		'schema'       => array(
			'description' => __( 'Featured image URL.' ),
			'type'        => 'string',
			'format'      => 'uri',
			'context'     => array( 'view', 'edit' ),
		),
	)
);
```

### Creating Custom Routes

Use `register_rest_route()` to create entirely new endpoints.

**Core Implementation:**
```34:156:wordpress/wp-includes/rest-api.php
function register_rest_route( $route_namespace, $route, $args = array(), $override = false ) {
```

**Example: Custom Endpoint**
```php
add_action( 'rest_api_init', 'register_custom_rest_routes' );

function register_custom_rest_routes() {
	register_rest_route(
		'myplugin/v1', // Namespace
		'/stats', // Route
		array(
			'methods'             => WP_REST_Server::READABLE,
			'callback'            => 'get_site_stats',
			'permission_callback' => function() {
				return current_user_can( 'manage_options' );
			},
			'args'                => array(
				'period' => array(
					'type'              => 'string',
					'enum'              => array( 'day', 'week', 'month' ),
					'default'           => 'week',
					'sanitize_callback' => 'sanitize_key',
				),
			),
		)
	);

	register_rest_route(
		'myplugin/v1',
		'/posts/(?P<id>\d+)/publish',
		array(
			'methods'             => WP_REST_Server::CREATABLE,
			'callback'            => 'publish_post',
			'permission_callback' => function( $request ) {
				$post_id = $request->get_param( 'id' );
				return current_user_can( 'publish_post', $post_id );
			},
		)
	);
}

function get_site_stats( $request ) {
	$period = $request->get_param( 'period' );

	// Calculate stats based on period
	$stats = array(
		'posts'    => wp_count_posts()->publish,
		'comments' => wp_count_comments()->approved,
		'period'   => $period,
	);

	return rest_ensure_response( $stats );
}

function publish_post( $request ) {
	$post_id = $request->get_param( 'id' );
	$post    = get_post( $post_id );

	if ( ! $post ) {
		return new WP_Error(
			'rest_post_invalid',
			__( 'Invalid post ID.' ),
			array( 'status' => 404 )
		);
	}

	$result = wp_update_post( array(
		'ID'          => $post_id,
		'post_status' => 'publish',
	) );

	if ( is_wp_error( $result ) ) {
		return $result;
	}

	return rest_ensure_response( array(
		'success' => true,
		'post_id' => $post_id,
	) );
}
```

### Important Notes

1. **Always use `rest_api_init` hook** - Routes must be registered on or after this hook
2. **Always include `permission_callback`** - Required since WordPress 5.5.0
3. **Use proper namespaces** - Use your plugin/theme prefix (e.g., `myplugin/v1`)
4. **Return WP_REST_Response or WP_Error** - Use `rest_ensure_response()` helper
5. **Define schema** - Helps with documentation and validation

**Core Registration Hook:**
```208:211:wordpress/wp-includes/rest-api.php
function rest_api_init() {
	rest_api_register_rewrites();

	global $wp;
```

**Reference:** [REST API Handbook - Extending the REST API](https://developer.wordpress.org/rest-api/extending-the-rest-api/)

---

## Exam Tips

### Key Points to Remember

1. **CRUD Operations:**
   - Core endpoints follow pattern: `/wp-json/wp/v2/{resource}`
   - Methods: GET (read), POST (create), PUT/PATCH (update), DELETE (delete)
   - Always check permissions before operations

2. **Authentication Methods:**
   - **Cookies:** Same-origin only, requires nonce (`X-WP-Nonce` header)
   - **Application Passwords:** HTTP Basic Auth, cross-origin, revocable
   - **OAuth:** Requires plugin, not in core
   - Authentication is checked in order: Application Passwords → OAuth → Cookies

3. **Validation and Sanitization:**
   - Always define `validate_callback` and `sanitize_callback` for custom endpoints
   - Use schema types (`string`, `integer`, etc.) and formats (`email`, `uri`, etc.)
   - Required parameters must be validated
   - Use WordPress sanitization functions (`sanitize_text_field`, `sanitize_email`, etc.)

4. **Extending Endpoints:**
   - Use `register_rest_field()` for adding fields to existing endpoints
   - Use `register_rest_route()` for custom endpoints
   - Always register on `rest_api_init` hook
   - `permission_callback` is required (since WP 5.5.0)
   - Return `WP_REST_Response` or `WP_Error`

5. **Common Mistakes:**
   - Missing `permission_callback` (required since 5.5.0)
   - Registering routes before `rest_api_init`
   - Not validating/sanitizing user input
   - Using cookie auth for cross-origin requests
   - Forgetting to return values in callbacks

6. **Security Best Practices:**
   - Always validate and sanitize all input
   - Check capabilities in `permission_callback`
   - Use nonces for cookie authentication
   - Prefer Application Passwords over exposing main passwords
   - Limit scope of custom endpoints to necessary operations

---

## Additional Resources

- [REST API Handbook - WordPress Developer Resources](https://developer.wordpress.org/rest-api/)
- [REST API Reference - WordPress Developer Resources](https://developer.wordpress.org/rest-api/reference/)
- [REST API Authentication - WordPress Developer Resources](https://developer.wordpress.org/rest-api/using-the-rest-api/authentication/)
- [Extending the REST API - WordPress Developer Resources](https://developer.wordpress.org/rest-api/extending-the-rest-api/)
- [Adding Custom Endpoints - WordPress Developer Resources](https://developer.wordpress.org/rest-api/extending-the-rest-api/adding-custom-endpoints/)
- Core Files:
  - `wp-includes/rest-api.php` - Main REST API functions
  - `wp-includes/rest-api/class-wp-rest-server.php` - REST server implementation
  - `wp-includes/rest-api/class-wp-rest-request.php` - Request handling and validation
  - `wp-includes/rest-api/endpoints/` - Core endpoint controllers
  - `wp-includes/user.php` - Application password authentication
