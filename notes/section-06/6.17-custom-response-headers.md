# 6.17 Custom Response Headers - Study Notes

## Overview

Custom response headers allow you to add debugging information to WordPress responses, making it easier to inspect headers in browser tools and use headers for API testing and debugging workflows.

**Key Reference:** [PHP header()](https://www.php.net/manual/en/function.header.php) | [HTTP Headers - MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)

---

## 1. Adding Debug Headers to WordPress Responses

### Using header() Function

**Basic Header:**
```php
// Add custom header
header( 'X-Debug-Info: Debug value' );

// Add multiple headers
header( 'X-Debug-User: ' . get_current_user_id() );
header( 'X-Debug-Time: ' . time() );
```

**Before Output:**
```php
// Headers must be sent before any output
// ❌ BAD - Output before header
echo 'Content';
header( 'X-Debug: value' ); // Warning: headers already sent

// ✅ GOOD - Header before output
header( 'X-Debug: value' );
echo 'Content';
```

### Using WordPress Hooks

**send_headers Hook:**
```php
add_action( 'send_headers', 'add_debug_headers' );

function add_debug_headers() {
    header( 'X-Debug-User-ID: ' . get_current_user_id() );
    header( 'X-Debug-Post-ID: ' . get_the_ID() );
    header( 'X-Debug-Query-Count: ' . get_num_queries() );
}
```

**template_redirect Hook:**
```php
add_action( 'template_redirect', 'add_debug_headers_early' );

function add_debug_headers_early() {
    header( 'X-Debug-Template: ' . get_page_template() );
    header( 'X-Debug-Is-Admin: ' . ( is_admin() ? 'yes' : 'no' ) );
}
```

### Conditional Headers

**Debug Mode Only:**
```php
add_action( 'send_headers', 'add_debug_headers_conditional' );

function add_debug_headers_conditional() {
    if ( defined( 'WP_DEBUG' ) && WP_DEBUG ) {
        header( 'X-Debug-Mode: enabled' );
        header( 'X-Debug-Memory: ' . memory_get_usage() );
        header( 'X-Debug-Queries: ' . get_num_queries() );
    }
}
```

---

## 2. Inspecting Headers in Browser Tools

### Browser DevTools

**Network Panel:**
1. Open DevTools (F12)
2. Go to Network tab
3. Reload page
4. Click on request
5. View Headers tab

**Response Headers:**
- Shows all response headers
- Includes custom headers
- Shows header values
- Can copy headers

### cURL Inspection

**View Headers:**
```bash
# View response headers
curl -I https://example.com

# View with verbose output
curl -v https://example.com

# View specific header
curl -I https://example.com | grep X-Debug
```

### Command Line Tools

**httpie:**
```bash
# View headers
http -h https://example.com

# Follow redirects
http -h -F https://example.com
```

---

## 3. Using Headers for API Testing

### REST API Headers

**Add Debug Headers to API:**
```php
add_filter( 'rest_pre_serve_request', 'add_api_debug_headers', 10, 4 );

function add_api_debug_headers( $served, $result, $request, $server ) {
    header( 'X-API-Version: 2.0' );
    header( 'X-API-Endpoint: ' . $request->get_route() );
    header( 'X-API-Method: ' . $request->get_method() );

    return $served;
}
```

**Test with cURL:**
```bash
# Test API with headers
curl -H "Accept: application/json" \
     -H "Authorization: Bearer token" \
     https://example.com/wp-json/wp/v2/posts

# Check debug headers
curl -I https://example.com/wp-json/wp/v2/posts | grep X-API
```

### AJAX Headers

**Add Debug Headers to AJAX:**
```php
add_action( 'admin_init', 'add_ajax_debug_headers' );

function add_ajax_debug_headers() {
    if ( defined( 'DOING_AJAX' ) && DOING_AJAX ) {
        header( 'X-AJAX-Action: ' . $_REQUEST['action'] );
        header( 'X-AJAX-User: ' . get_current_user_id() );
    }
}
```

---

## 4. Common Debug Headers

### Performance Headers

**Query Count:**
```php
header( 'X-Query-Count: ' . get_num_queries() );
```

**Execution Time:**
```php
header( 'X-Execution-Time: ' . timer_stop() . 's' );
```

**Memory Usage:**
```php
header( 'X-Memory-Usage: ' . size_format( memory_get_usage() ) );
header( 'X-Memory-Peak: ' . size_format( memory_get_peak_usage() ) );
```

### Cache Headers

**Cache Status:**
```php
header( 'X-Cache-Status: ' . ( wp_cache_get( 'key' ) ? 'hit' : 'miss' ) );
```

**Cache Key:**
```php
header( 'X-Cache-Key: ' . wp_cache_key( 'group', 'key' ) );
```

### Request Headers

**Request Info:**
```php
header( 'X-Request-URI: ' . $_SERVER['REQUEST_URI'] );
header( 'X-Request-Method: ' . $_SERVER['REQUEST_METHOD'] );
header( 'X-User-Agent: ' . $_SERVER['HTTP_USER_AGENT'] );
```

---

## 5. Best Practices

### Header Naming

**Use Prefixes:**
```php
// ✅ GOOD - Use X- prefix for custom headers
header( 'X-Debug-Info: value' );
header( 'X-MyPlugin-Data: value' );

// ❌ BAD - Don't use standard header names
header( 'Content-Type: application/json' ); // Conflicts with WordPress
```

### Security Considerations

**Don't Expose Sensitive Data:**
```php
// ❌ BAD - Exposes sensitive data
header( 'X-Debug-Password: ' . $password );

// ✅ GOOD - Only non-sensitive debug info
header( 'X-Debug-User-ID: ' . get_current_user_id() );
```

### Performance

**Conditional Headers:**
```php
// Only add in debug mode
if ( defined( 'WP_DEBUG' ) && WP_DEBUG ) {
    header( 'X-Debug-Info: value' );
}
```

---

## Exam Tips

### Key Points to Remember

1. **Adding Headers:**
   - Use `header()` function
   - Must be before output
   - Use WordPress hooks
   - Check WP_DEBUG

2. **Inspecting Headers:**
   - Browser DevTools Network panel
   - cURL with `-I` flag
   - Command line tools
   - Check response headers

3. **API Testing:**
   - Add headers to REST API
   - Add headers to AJAX
   - Test with cURL
   - Verify header values

4. **Best Practices:**
   - Use X- prefix
   - Don't expose sensitive data
   - Conditional on WP_DEBUG
   - Remove in production

5. **Common Headers:**
   - Query count
   - Execution time
   - Memory usage
   - Cache status

---

## Additional Resources

- [PHP header()](https://www.php.net/manual/en/function.header.php)
- [HTTP Headers - MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
- [WordPress Hooks - send_headers](https://developer.wordpress.org/reference/hooks/send_headers/)
