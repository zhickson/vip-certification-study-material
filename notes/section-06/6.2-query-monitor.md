# 6.2 Query Monitor - Study Notes

## Overview

Query Monitor is a comprehensive debugging plugin for WordPress that provides detailed information about database queries, HTTP requests, hooks, conditionals, and enqueued assets. It's the most powerful debugging tool for WordPress development.

**Key Reference:** [Query Monitor Plugin](https://wordpress.org/plugins/query-monitor/)

---

## 1. Tracing Database Query Performance

### Installation

```bash
wp plugin install query-monitor --activate
```

### Database Queries Panel

**Features:**
- Lists all database queries with execution time
- Shows query call stack
- Identifies duplicate queries
- Highlights slow queries
- Provides EXPLAIN analysis

### Query Information

**Displayed Data:**
- SQL query text
- Execution time (milliseconds)
- Query caller (function/file/line)
- Component (plugin/theme/core)
- Query type (SELECT, INSERT, UPDATE, DELETE)

**Example:**
```
Query 1: SELECT * FROM wp_posts WHERE ID = 123
Time: 0.45ms
Caller: get_post() in my-plugin.php:45
Component: My Plugin
```

### Slow Query Detection

**Identifying Slow Queries:**
- Queries highlighted in red if > 10ms
- Total query time displayed
- Query count shown
- Duplicate queries flagged

### EXPLAIN Analysis

**Query Analysis:**
- Click query to see EXPLAIN output
- Identifies missing indexes
- Shows query execution plan
- Highlights performance issues

**Example EXPLAIN Output:**
```
type: ALL (full table scan)
key: NULL (no index used)
rows: 10,000
Extra: Using where
```

---

## 2. Debugging HTTP Requests and Responses

### HTTP Requests Panel

**Features:**
- Lists all HTTP requests made by WordPress
- Shows request method, URL, and headers
- Displays response status and time
- Shows request body and response body

### Request Information

**Displayed Data:**
- Request URL
- HTTP method (GET, POST, etc.)
- Request headers
- Request body
- Response status code
- Response headers
- Response body
- Execution time

### Common Use Cases

**1. API Calls:**
```php
// Track wp_remote_get() calls
$response = wp_remote_get( 'https://api.example.com/data' );
// Query Monitor shows this request
```

**2. AJAX Requests:**
- Shows admin-ajax.php requests
- Displays AJAX action and data
- Tracks AJAX response time

**3. REST API:**
- Lists REST API endpoint calls
- Shows authentication headers
- Displays response data

---

## 3. Inspecting Conditionals, Hooks, and Loaded Assets

### Conditionals Panel

**Features:**
- Shows all WordPress conditionals evaluated
- Indicates which conditionals are true/false
- Helps debug template selection
- Identifies conditional logic issues

**Example:**
```
is_home(): true
is_front_page(): false
is_single(): false
is_admin(): false
```

### Hooks Panel

**Features:**
- Lists all hooks fired during page load
- Shows hook execution time
- Displays registered callbacks
- Shows hook priorities
- Identifies slow hooks

**Hook Information:**
- Hook name
- Type (action or filter)
- Priority
- Callback function
- Execution time
- Component

**Example:**
```
init (action)
  Priority 10: my_plugin_init() - 2.3ms
  Priority 20: another_callback() - 0.5ms

the_content (filter)
  Priority 10: wpautop() - 1.2ms
```

### Assets Panel

**Features:**
- Lists all enqueued scripts
- Shows enqueued styles
- Displays dependencies
- Identifies missing dependencies
- Shows asset versions

**Script Information:**
- Script handle
- Source URL
- Dependencies
- Version
- In footer (true/false)

**Style Information:**
- Style handle
- Source URL
- Dependencies
- Version
- Media type

---

## 4. Advanced Features

### Performance Profiling

**Timing Information:**
- Total page generation time
- Database query time
- HTTP request time
- Hook execution time
- Memory usage

### Component Analysis

**Component Breakdown:**
- Queries by component (plugin/theme/core)
- Hooks by component
- Assets by component
- Identifies problematic plugins

### Environment Information

**System Details:**
- PHP version
- WordPress version
- Database version
- Server software
- Memory limits
- PHP extensions

---

## 5. Using Query Monitor for Debugging

### Common Debugging Scenarios

**1. Slow Page Load:**
- Check total query time
- Identify slow queries
- Review HTTP requests
- Check hook execution time

**2. Missing Assets:**
- Check Assets panel
- Verify dependencies
- Check enqueue hooks
- Review asset URLs

**3. Template Issues:**
- Check Conditionals panel
- Verify template hierarchy
- Review query variables
- Check main query

**4. Hook Problems:**
- Check Hooks panel
- Verify hook firing
- Check priorities
- Review callback execution

---

## 6. Query Monitor Extensions

### Available Extensions

- **Query Monitor Extend** - Additional panels
- **Query Monitor Collector** - Custom data collection
- **Query Monitor Output** - Custom output formats

### Creating Custom Collectors

```php
// Example custom collector
class My_Plugin_QM_Collector extends QM_Collector {
    public $id = 'my_plugin';

    public function process() {
        $this->data['custom_data'] = get_option( 'my_plugin_data' );
    }
}

add_filter( 'qm/collectors', function( $collectors ) {
    $collectors['my_plugin'] = new My_Plugin_QM_Collector();
    return $collectors;
} );
```

---

## Exam Tips

### Key Points to Remember

1. **Query Monitor Features:**
   - Database query performance
   - HTTP request debugging
   - Hook inspection
   - Conditional debugging
   - Asset tracking

2. **Query Analysis:**
   - Slow query detection
   - EXPLAIN analysis
   - Duplicate query identification
   - Query call stack

3. **HTTP Requests:**
   - Request/response details
   - Status codes
   - Headers and body
   - Execution time

4. **Hooks and Conditionals:**
   - Hook execution order
   - Conditional evaluation
   - Component breakdown
   - Performance profiling

5. **Best Practices:**
   - Use in development only
   - Check slow queries first
   - Verify hooks are firing
   - Review asset dependencies

---

## Additional Resources

- [Query Monitor Plugin](https://wordpress.org/plugins/query-monitor/)
- [Query Monitor Documentation](https://github.com/johnbillion/query-monitor/wiki)
- [Debugging in WordPress - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/debug/debug-wordpress/)
