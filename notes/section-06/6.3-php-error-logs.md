# 6.3 PHP Error Logs - Study Notes

## Overview

PHP error logs are essential for debugging WordPress issues. Understanding how to configure, access, and interpret PHP errors, warnings, and notices is crucial for identifying and fixing problems.

**Key Reference:** [Debugging in WordPress - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/debug/debug-wordpress/)

---

## 1. Accessing PHP Error Logs in Different Environments

### WordPress Debug Configuration

**wp-config.php Settings:**
```php
// Enable WordPress debugging
define( 'WP_DEBUG', true );

// Log errors to file
define( 'WP_DEBUG_LOG', true );

// Don't display errors on screen
define( 'WP_DEBUG_DISPLAY', false );

// Hide errors from visitors
@ini_set( 'display_errors', 0 );
```

### WordPress Debug Log Location

**Default Location:**
```
wp-content/debug.log
```

**Custom Location:**
```php
// Custom log file path
define( 'WP_DEBUG_LOG', '/path/to/custom/debug.log' );
```

### Server Error Log Locations

**Common Locations:**
- **Apache:** `/var/log/apache2/error.log` or `/var/log/httpd/error_log`
- **Nginx:** `/var/log/nginx/error.log`
- **cPanel:** `~/public_html/error_log` or `~/logs/error_log`
- **Local (MAMP):** `/Applications/MAMP/logs/php_error.log`
- **Local (XAMPP):** `C:\xampp\apache\logs\error.log`

### Accessing Logs

**Via Command Line:**
```bash
# WordPress debug log
tail -f wp-content/debug.log

# Server error log
tail -f /var/log/apache2/error.log

# Follow log in real-time
tail -f wp-content/debug.log | grep "ERROR"
```

**Via FTP/SFTP:**
- Download `wp-content/debug.log`
- Check server error logs via hosting control panel

---

## 2. Configuring Error Reporting for Development vs Production

### Development Configuration

**wp-config.php:**
```php
// Development settings
define( 'WP_DEBUG', true );
define( 'WP_DEBUG_LOG', true );
define( 'WP_DEBUG_DISPLAY', true );
define( 'SCRIPT_DEBUG', true );

// Show all errors
error_reporting( E_ALL );
ini_set( 'display_errors', 1 );
ini_set( 'log_errors', 1 );
```

### Production Configuration

**wp-config.php:**
```php
// Production settings
define( 'WP_DEBUG', false );
define( 'WP_DEBUG_LOG', false );
define( 'WP_DEBUG_DISPLAY', false );

// Hide errors from users
error_reporting( 0 );
ini_set( 'display_errors', 0 );
ini_set( 'log_errors', 1 );

// Log to server error log only
ini_set( 'error_log', '/var/log/php-errors.log' );
```

### WordPress Debug Mode Function

**Core Implementation:**
```578:628:wordpress/wp-includes/load.php
function wp_debug_mode() {
	/**
	 * Filters whether to allow the debug mode check to occur.
	 *
	 * This filter runs before it can be used by plugins. It is designed for
	 * non-web runtimes. Returning false causes the `WP_DEBUG` and related
	 * constants to not be checked and the default PHP values for errors
	 * will be used unless you take care to update them yourself.
	 *
	 * To use this filter you must define a `$wp_filter` global before
	 * WordPress loads, usually in `wp-config.php`.
	 *
	 * @since 4.6.0
	 *
	 * @param bool $enable_debug_mode Whether to enable debug mode checks to occur. Default true.
	 */
	if ( ! apply_filters( 'enable_wp_debug_mode_checks', true ) ) {
		return;
	}

	if ( WP_DEBUG ) {
		error_reporting( E_ALL );

		if ( WP_DEBUG_DISPLAY ) {
			ini_set( 'display_errors', 1 );
		} elseif ( null !== WP_DEBUG_DISPLAY ) {
			ini_set( 'display_errors', 0 );
		}

		if ( in_array( strtolower( (string) WP_DEBUG_LOG ), array( 'true', '1' ), true ) ) {
			$log_path = WP_CONTENT_DIR . '/debug.log';
		} elseif ( is_string( WP_DEBUG_LOG ) ) {
			$log_path = WP_DEBUG_LOG;
		} else {
			$log_path = false;
		}
```

### Environment-Based Configuration

**Dynamic Configuration:**
```php
// Detect environment
$is_development = ( 'development' === wp_get_environment_type() );

if ( $is_development ) {
    define( 'WP_DEBUG', true );
    define( 'WP_DEBUG_LOG', true );
    define( 'WP_DEBUG_DISPLAY', true );
} else {
    define( 'WP_DEBUG', false );
    define( 'WP_DEBUG_LOG', false );
    define( 'WP_DEBUG_DISPLAY', false );
}
```

---

## 3. Distinguishing Fatal Errors from Notices

### Error Types

**1. Fatal Errors (E_ERROR):**
```
PHP Fatal error: Call to undefined function my_function() in /path/to/file.php on line 42
```

**Characteristics:**
- Stops script execution immediately
- Cannot be caught with try/catch
- Requires code fix to resolve
- Shows in error logs

**2. Warnings (E_WARNING):**
```
PHP Warning: include(/path/to/missing.php): failed to open stream: No such file or directory in /path/to/file.php on line 10
```

**Characteristics:**
- Script continues execution
- Indicates potential problems
- Should be fixed but not critical
- Shows in error logs

**3. Notices (E_NOTICE):**
```
PHP Notice: Undefined variable: $my_var in /path/to/file.php on line 15
```

**Characteristics:**
- Script continues execution
- Minor issues or best practice violations
- Often safe to ignore temporarily
- Shows in error logs

**4. Deprecated Warnings:**
```
PHP Deprecated: Function create_function() is deprecated in /path/to/file.php on line 20
```

**Characteristics:**
- Function will be removed in future
- Should update code
- Script continues execution
- Shows in error logs

### Error Severity Levels

**PHP Error Constants:**
```php
E_ERROR         // Fatal run-time errors
E_WARNING       // Run-time warnings
E_PARSE         // Compile-time parse errors
E_NOTICE        // Run-time notices
E_CORE_ERROR    // Fatal errors during PHP startup
E_CORE_WARNING  // Warnings during PHP startup
E_COMPILE_ERROR // Fatal compile-time errors
E_COMPILE_WARNING // Compile-time warnings
E_USER_ERROR    // User-generated error message
E_USER_WARNING   // User-generated warning message
E_USER_NOTICE    // User-generated notice message
E_STRICT         // Runtime notices (suggestions)
E_RECOVERABLE_ERROR // Catchable fatal errors
E_DEPRECATED      // Deprecated function warnings
E_USER_DEPRECATED // User-generated deprecation warnings
E_ALL            // All errors and warnings
```

### Interpreting Error Messages

**Error Format:**
```
[Date Time] PHP ErrorType: Error message in /path/to/file.php on line X
```

**Example:**
```
[15-Jan-2024 10:30:45 UTC] PHP Fatal error: Uncaught Error: Call to undefined function my_function() in /var/www/html/wp-content/plugins/my-plugin/includes/functions.php:42
Stack trace:
#0 /var/www/html/wp-content/themes/my-theme/functions.php(15): my_plugin_function()
#1 /var/www/html/wp-includes/class-wp-hook.php(324): my_theme_function()
#2 /var/www/html/wp-includes/plugin.php(205): WP_Hook->do_action()
#3 /var/www/html/wp-settings.php(495): do_action('init')
#4 /var/www/html/wp-config.php(89): require_once('/var/www/html/wp-settings.php')
#5 /var/www/html/wp-load.php(50): require_once('/var/www/html/wp-config.php')
#6 /var/www/html/wp-blog-header.php(13): require_once('/var/www/html/wp-load.php')
#7 /var/www/html/index.php(17): require('/var/www/html/wp-blog-header.php')
```

**Stack Trace Analysis:**
- Shows call chain leading to error
- Helps identify root cause
- Shows file and line numbers
- Indicates plugin/theme conflicts

---

## 4. Common WordPress Error Patterns

### Database Connection Errors

**Error:**
```
PHP Warning: mysqli_connect(): (HY000/2002): Connection refused
```

**Causes:**
- Incorrect database credentials
- Database server down
- Network issues
- Firewall blocking connection

### Memory Exhaustion

**Error:**
```
PHP Fatal error: Allowed memory size of 268435456 bytes exhausted
```

**Solutions:**
```php
// Increase memory limit
define( 'WP_MEMORY_LIMIT', '256M' );
define( 'WP_MAX_MEMORY_LIMIT', '512M' );
```

### Plugin/Theme Conflicts

**Error:**
```
PHP Fatal error: Cannot redeclare function_name() in /path/to/file.php
```

**Causes:**
- Function defined twice
- Plugin conflict
- Theme conflict

### Missing Files

**Error:**
```
PHP Warning: require_once(/path/to/file.php): failed to open stream: No such file or directory
```

**Causes:**
- File deleted or moved
- Incorrect path
- Permissions issue

---

## 5. Best Practices for Error Logging

### Log Rotation

**Prevent Log File Growth:**
```php
// Rotate log file if too large
$log_file = WP_CONTENT_DIR . '/debug.log';
if ( file_exists( $log_file ) && filesize( $log_file ) > 10485760 ) { // 10MB
    rename( $log_file, $log_file . '.' . date( 'Y-m-d' ) );
}
```

### Custom Error Logging

**Log Specific Events:**
```php
// Log custom events
if ( defined( 'WP_DEBUG_LOG' ) && WP_DEBUG_LOG ) {
    error_log( 'Custom event: User logged in - User ID: ' . $user_id );
}
```

### Filtering Errors

**Log Only Important Errors:**
```php
// Set error reporting level
error_reporting( E_ERROR | E_WARNING | E_PARSE );
```

---

## Exam Tips

### Key Points to Remember

1. **Error Log Locations:**
   - WordPress: `wp-content/debug.log`
   - Server: Varies by hosting
   - Configured via `WP_DEBUG_LOG`

2. **Configuration:**
   - Development: Show and log errors
   - Production: Log only, hide from users
   - Use `wp_debug_mode()` function

3. **Error Types:**
   - Fatal: Stops execution
   - Warning: Continues with issue
   - Notice: Minor issue, continues
   - Deprecated: Future removal warning

4. **Common Issues:**
   - Database connection errors
   - Memory exhaustion
   - Plugin/theme conflicts
   - Missing files

5. **Best Practices:**
   - Rotate log files
   - Use environment-based config
   - Don't display errors in production
   - Monitor log file size

---

## Additional Resources

- [Debugging in WordPress - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/debug/debug-wordpress/)
- [PHP Error Reporting - PHP Manual](https://www.php.net/manual/en/errorfunc.configuration.php)
- Core Files:
  - `wp-includes/load.php` - `wp_debug_mode()` function
  - `wp-includes/default-constants.php` - Debug constants
