# 6.22 Static Analysis Tools - Study Notes

## Overview

Static analysis tools like PHPStan, Psalm, and PHPCS catch errors before runtime, detect unsafe code patterns, identify deprecated functions, and can be integrated into CI pipelines.

**Key Reference:** [PHPStan](https://phpstan.org/) | [Psalm](https://psalm.dev/) | [PHPCS](https://github.com/squizlabs/PHP_CodeSniffer)

---

## 1. Using PHPStan, Psalm, and PHPCS

### PHPStan

**Installation:**
```bash
composer require --dev phpstan/phpstan
```

**Configuration:**
```neon
# phpstan.neon
parameters:
    level: 5
    paths:
        - wp-content/plugins/my-plugin
    excludePaths:
        - wp-content/plugins/my-plugin/vendor
```

**Run:**
```bash
vendor/bin/phpstan analyse
```

### Psalm

**Installation:**
```bash
composer require --dev vimeo/psalm
```

**Configuration:**
```xml
<!-- psalm.xml -->
<psalm>
    <projectFiles>
        <directory name="wp-content/plugins/my-plugin" />
    </projectFiles>
</psalm>
```

**Run:**
```bash
vendor/bin/psalm
```

### PHPCS

**Installation:**
```bash
composer require --dev squizlabs/php_codesniffer
```

**WordPress Standards:**
```bash
composer require --dev wp-coding-standards/wpcs
```

**Run:**
```bash
vendor/bin/phpcs --standard=WordPress wp-content/plugins/my-plugin
```

---

## 2. Detecting Unsafe Code and Deprecated Functions

### PHPStan Rules

**Detect Issues:**
- Type errors
- Undefined variables
- Deprecated functions
- Unsafe operations

### Psalm Rules

**Detect Issues:**
- Type mismatches
- Null pointer exceptions
- Deprecated functions
- Security vulnerabilities

### PHPCS Rules

**Detect Issues:**
- Coding standards violations
- Deprecated functions
- Security issues
- Best practices

---

## 3. Integrating Static Analysis into CI

### GitHub Actions

**Workflow:**
```yaml
name: Static Analysis
on: [push, pull_request]
jobs:
  phpstan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: php-actions/composer@v5
      - run: vendor/bin/phpstan analyse
```

### GitLab CI

**Configuration:**
```yaml
phpstan:
  script:
    - composer install
    - vendor/bin/phpstan analyse
```

---

## Exam Tips

### Key Points to Remember

1. **Tools:**
   - PHPStan for type checking
   - Psalm for security
   - PHPCS for standards

2. **Integration:**
   - CI/CD pipelines
   - Pre-commit hooks
   - Automated checks

3. **Benefits:**
   - Catch errors early
   - Improve code quality
   - Enforce standards

---

## Additional Resources

- [PHPStan](https://phpstan.org/)
- [Psalm](https://psalm.dev/)
- [PHPCS](https://github.com/squizlabs/PHP_CodeSniffer)
- [WordPress Coding Standards](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/)
