# 6.5 APM Tools (New Relic, Datadog) - Study Notes

## Overview

Application Performance Monitoring (APM) tools like New Relic and Datadog provide real-time monitoring, performance metrics, and error tracking for WordPress applications. They help identify bottlenecks, slow transactions, and performance issues in production environments.

**Key Reference:** [New Relic Documentation](https://docs.newrelic.com/) | [Datadog Documentation](https://docs.datadoghq.com/)

---

## 1. Identifying Slow Transactions and Bottlenecks

### New Relic

**Transaction Overview:**
- Lists all transactions (page loads, AJAX, API calls)
- Shows average response time
- Identifies slowest transactions
- Displays transaction throughput

**Slow Transaction Analysis:**
- Click transaction to see details
- View execution time breakdown
- Identify slow database queries
- Find slow external API calls
- Analyse function execution time

**Example Transaction Breakdown:**
```
Total Time: 2.45s
  - Database: 1.2s (49%)
  - External API: 0.8s (33%)
  - PHP: 0.4s (16%)
  - Other: 0.05s (2%)
```

### Datadog

**APM Dashboard:**
- Service map showing dependencies
- Transaction traces
- Performance metrics
- Error rates

**Transaction Traces:**
- Visual timeline of execution
- Span breakdown by component
- Database query details
- External service calls

---

## 2. Tracing Backend Performance Metrics

### Key Metrics

**Response Time:**
- Average response time
- P95/P99 percentiles
- Slowest requests
- Time series graphs

**Throughput:**
- Requests per second
- Peak load times
- Traffic patterns
- Capacity planning

**Error Rate:**
- Error percentage
- Error types
- Error trends
- Error details

### Database Performance

**Query Metrics:**
- Slow query identification
- Query execution time
- Query frequency
- Database connection pool

**Example Metrics:**
```
Slow Queries (> 1s):
  - SELECT * FROM wp_posts: 2.3s (15 occurrences)
  - SELECT meta_value FROM wp_postmeta: 1.8s (8 occurrences)
```

### External Service Performance

**API Call Metrics:**
- Response time
- Success/failure rate
- Timeout occurrences
- Dependency health

### PHP Performance

**Function-Level Metrics:**
- Function execution time
- Function call count
- Memory usage
- CPU usage

---

## 3. Monitoring WordPress Processes in Real-Time

### Real-Time Dashboards

**New Relic Dashboard:**
- Live transaction feed
- Real-time error tracking
- Current response times
- Active user sessions

**Datadog Dashboard:**
- Live service map
- Real-time metrics
- Active traces
- Current alerts

### Alerts and Notifications

**Alert Configuration:**
- Response time thresholds
- Error rate thresholds
- Availability monitoring
- Custom metric alerts

**Example Alerts:**
```
Alert: Response time > 2s for 5 minutes
Alert: Error rate > 5% for 10 minutes
Alert: Database query time > 1s
```

### WordPress-Specific Monitoring

**Plugin Performance:**
- Identify slow plugins
- Plugin execution time
- Plugin conflicts
- Plugin resource usage

**Theme Performance:**
- Theme load time
- Template rendering time
- Asset load time
- Theme optimization opportunities

**Hook Performance:**
- Hook execution time
- Slow hooks identification
- Hook frequency
- Hook optimization

---

## 4. Setting Up APM for WordPress

### New Relic Setup

**Installation:**
```bash
# Install New Relic PHP agent
wget -O - https://download.newrelic.com/548C16BF.gpg | apt-key add -
echo "deb https://download.newrelic.com/debian/ newrelic non-free" | tee /etc/apt/sources.list.d/newrelic.list
apt-get update
apt-get install newrelic-php5
```

**Configuration:**
```ini
; php.ini
newrelic.license=YOUR_LICENSE_KEY
newrelic.appname="WordPress Site"
newrelic.enabled=true
```

**WordPress Integration:**
```php
// wp-config.php
if ( function_exists( 'newrelic_set_appname' ) ) {
    newrelic_set_appname( 'WordPress Site' );
}
```

### Datadog Setup

**Installation:**
```bash
# Install Datadog agent
DD_API_KEY=YOUR_API_KEY bash -c "$(curl -L https://s3.amazonaws.com/dd-agent/install_script.sh)"
```

**PHP Tracer:**
```bash
# Install PHP tracer
pecl install datadog-trace
```

**Configuration:**
```ini
; php.ini
extension=ddtrace.so
datadog.trace.enabled=true
datadog.service=wordpress
```

---

## 5. Analysing APM Data

### Transaction Analysis

**Identify Patterns:**
- Slow pages
- Peak traffic times
- User behaviour
- Performance degradation

**Root Cause Analysis:**
- Database bottlenecks
- External API delays
- Plugin conflicts
- Server resource limits

### Performance Trends

**Historical Analysis:**
- Performance over time
- Impact of deployments
- Seasonal patterns
- Growth trends

### Error Analysis

**Error Tracking:**
- Error frequency
- Error types
- Error locations
- Error impact

**Example Error Analysis:**
```
Top Errors:
  1. Database connection timeout (45 occurrences)
  2. Memory limit exceeded (12 occurrences)
  3. External API timeout (8 occurrences)
```

---

## 6. Best Practices for APM

### Configuration

**App Naming:**
- Use descriptive names
- Include environment (prod/staging)
- Version information
- Service identification

**Sampling:**
- Configure appropriate sampling rate
- Balance detail vs performance
- Adjust based on traffic

### Monitoring Strategy

**Key Metrics to Monitor:**
- Response time (P95, P99)
- Error rate
- Throughput
- Database performance
- External service health

**Alert Thresholds:**
- Set realistic thresholds
- Avoid alert fatigue
- Use different thresholds per environment
- Monitor trends, not just spikes

### WordPress-Specific Considerations

**Plugin Impact:**
- Monitor plugin performance
- Track plugin conflicts
- Identify resource-heavy plugins

**Caching Impact:**
- Monitor cache hit rates
- Track cache invalidation
- Measure cache effectiveness

**Database Performance:**
- Monitor query performance
- Track slow queries
- Identify query patterns

---

## Exam Tips

### Key Points to Remember

1. **APM Tools Features:**
   - Slow transaction identification
   - Performance metrics
   - Error tracking
   - Real-time monitoring

2. **Key Metrics:**
   - Response time
   - Throughput
   - Error rate
   - Database performance

3. **Setup:**
   - Install agent/tracer
   - Configure license/API key
   - Set app name
   - Enable monitoring

4. **Analysis:**
   - Identify bottlenecks
   - Analyse transaction traces
   - Track performance trends
   - Monitor errors

5. **Best Practices:**
   - Use descriptive app names
   - Configure appropriate sampling
   - Set realistic alert thresholds
   - Monitor WordPress-specific metrics

---

## Additional Resources

- [New Relic Documentation](https://docs.newrelic.com/)
- [Datadog Documentation](https://docs.datadoghq.com/)
- [New Relic WordPress Integration](https://docs.newrelic.com/docs/agents/php-agent/frameworks/wordpress)
- [Datadog PHP Tracer](https://docs.datadoghq.com/tracing/setup/php/)
