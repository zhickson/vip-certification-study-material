# 7.4 Vertical vs. Horizontal Scaling - Study Notes

## Overview

Understanding the trade-offs between vertical scaling (scaling up) and horizontal scaling (scaling out) is essential for planning WordPress infrastructure that can handle growth.

**Key Reference:** [Scaling WordPress - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/performance/scaling/)

---

## 1. Differentiating CPU/RAM Upgrades (Vertical) vs Multi-Server Scaling (Horizontal)

### Vertical Scaling (Scale Up)

**Definition:**
- Adding more resources to a single server
- Increasing CPU cores, RAM, or storage
- Upgrading hardware capabilities
- Single server handles all traffic

**Characteristics:**
- Simpler architecture
- Single point of failure
- Limited by hardware maximums
- Easier to manage initially

**Example:**
```
Before: 4 CPU cores, 8GB RAM
After:  16 CPU cores, 64GB RAM
```

### Horizontal Scaling (Scale Out)

**Definition:**
- Adding more servers to handle load
- Distributing traffic across multiple servers
- Load balancing between servers
- Multiple servers share the workload

**Characteristics:**
- More complex architecture
- Better fault tolerance
- Can scale almost indefinitely
- Requires load balancing and shared state

**Example:**
```
Before: 1 server
After:  5 servers behind load balancer
```

---

## 2. Recognising When Vertical Scaling is Cost-Effective

### When to Scale Vertically

**Small to Medium Traffic:**
- Traffic fits on single server
- Cost of additional server > cost of upgrade
- Simpler management preferred
- Budget constraints

**Low Complexity:**
- Single application instance
- No need for geographic distribution
- Predictable traffic patterns
- Limited growth expected

**Cost Considerations:**
```php
// Vertical scaling cost example
$vertical_cost = array(
	'server_upgrade' => 500, // Monthly
	'management' => 100,
	'total' => 600,
);

// Horizontal scaling cost example
$horizontal_cost = array(
	'server_1' => 200,
	'server_2' => 200,
	'load_balancer' => 100,
	'management' => 200, // More complex
	'total' => 700,
);
```

### Vertical Scaling Limits

**Hardware Maximums:**
- CPU: Limited by processor architecture
- RAM: Limited by motherboard/OS
- Storage: Limited by drive capacity
- Network: Limited by network interface

**Performance Ceilings:**
- Single-threaded operations can't use all cores
- Memory bandwidth limitations
- I/O bottlenecks
- Database connection limits

---

## 3. Planning for Horizontal Scaling at Higher Traffic Levels

### When to Scale Horizontally

**High Traffic:**
- Traffic exceeds single server capacity
- Need for geographic distribution
- Requires high availability
- Unpredictable traffic spikes

**Growth Requirements:**
- Expected significant growth
- Need for redundancy
- Multi-region deployment
- Complex application architecture

### Horizontal Scaling Architecture

**Load Balancer Configuration:**
```nginx
# Nginx load balancer example
upstream wordpress_backend {
	least_conn; # Load balancing method
	server 10.0.1.1:80 weight=3;
	server 10.0.1.2:80 weight=3;
	server 10.0.1.3:80 weight=2;

	keepalive 32;
}

server {
	listen 80;
	server_name example.com;

	location / {
		proxy_pass http://wordpress_backend;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}
```

**Shared State Requirements:**
```php
// WordPress requires shared state for:
// 1. Database (shared MySQL/MariaDB)
// 2. File uploads (shared storage or NFS)
// 3. Sessions (Redis/Memcached)
// 4. Object cache (Redis/Memcached)

// Database connection
define( 'DB_HOST', 'shared-db.example.com' );

// Shared uploads
define( 'UPLOADS', 'wp-content/uploads' );
// Use NFS or object storage (S3)

// Shared sessions
ini_set( 'session.save_handler', 'redis' );
ini_set( 'session.save_path', 'tcp://redis-cluster:6379' );
```

### Stateless Application Design

**Design for Horizontal Scaling:**
```php
// ❌ BAD - State stored in local files
file_put_contents( 'cache/data.txt', $data );

// ✅ GOOD - State in shared cache
wp_cache_set( 'data', $data, '', 3600 );

// ❌ BAD - Local file uploads
$upload_dir = wp_upload_dir();
move_uploaded_file( $file, $upload_dir['path'] . '/file.jpg' );

// ✅ GOOD - Object storage
$s3_client->putObject( array(
	'Bucket' => 'wordpress-uploads',
	'Key' => 'uploads/file.jpg',
	'Body' => fopen( $file, 'r' ),
) );
```

---

## 4. Hybrid Scaling Approaches

### Combining Vertical and Horizontal

**Typical Enterprise Architecture:**
```
Load Balancer
    |
    +-- App Server 1 (16 cores, 64GB RAM) - Vertical scaling
    +-- App Server 2 (16 cores, 64GB RAM) - Vertical scaling
    +-- App Server 3 (16 cores, 64GB RAM) - Vertical scaling
    |
    +-- Database Server (32 cores, 128GB RAM) - Vertical scaling
    +-- Cache Server Cluster (Horizontal scaling)
    +-- CDN (Horizontal scaling)
```

### Database Scaling

**Vertical Database Scaling:**
- Increase CPU/RAM for single database server
- Use for read-heavy workloads
- Simpler replication setup
- Cost-effective up to certain point

**Horizontal Database Scaling:**
- Read replicas for read scaling
- Sharding for write scaling
- More complex but more scalable

**Read Replicas:**
```php
// WordPress read replica configuration
define( 'DB_HOST', 'master-db.example.com' );
define( 'DB_READ_HOST', 'replica-db.example.com' );

// Use read replica for queries
global $wpdb;
$wpdb->db_connect( DB_READ_HOST, DB_USER, DB_PASSWORD, DB_NAME );
```

---

## 5. Cost Analysis

### Vertical Scaling Costs

**One-Time Costs:**
- Hardware purchase/upgrade
- Migration downtime
- Configuration changes

**Ongoing Costs:**
- Higher-tier hosting
- Maintenance
- Monitoring

### Horizontal Scaling Costs

**One-Time Costs:**
- Load balancer setup
- Network configuration
- Shared storage setup
- Migration complexity

**Ongoing Costs:**
- Multiple server hosting
- Load balancer fees
- Increased management overhead
- Monitoring multiple servers

### Cost Comparison Example

**Scenario: 100,000 page views/day**

**Vertical Scaling:**
```
Server: $500/month (high-end)
Management: $100/month
Total: $600/month
```

**Horizontal Scaling:**
```
3 Servers: $200/month each = $600/month
Load Balancer: $50/month
Shared Storage: $100/month
Management: $200/month
Total: $950/month
```

**Break-even Analysis:**
- Vertical: Better for < 200k page views/day
- Horizontal: Better for > 200k page views/day
- Consider growth trajectory

---

## 6. Migration Strategies

### Vertical Scaling Migration

**Steps:**
1. Provision larger server
2. Migrate data and code
3. Update DNS
4. Decommission old server

**Downtime:**
- Typically 1-4 hours
- Can use maintenance mode
- Simpler migration process

### Horizontal Scaling Migration

**Steps:**
1. Set up load balancer
2. Provision additional servers
3. Configure shared storage
4. Set up database replication
5. Gradually add servers to pool
6. Monitor and adjust

**Downtime:**
- Minimal with proper setup
- Can be done gradually
- More complex but less disruptive

---

## Exam Tips

### Key Points to Remember

1. **Vertical Scaling:**
   - Add resources to single server
   - Simpler architecture
   - Cost-effective for small-medium traffic
   - Limited by hardware maximums

2. **Horizontal Scaling:**
   - Add more servers
   - More complex architecture
   - Better for high traffic
   - Requires shared state management

3. **When to Choose:**
   - Vertical: Small-medium sites, budget constraints, simplicity
   - Horizontal: High traffic, growth expected, high availability needed

4. **Shared State:**
   - Database must be shared
   - File uploads need shared storage
   - Sessions in Redis/Memcached
   - Object cache in Redis/Memcached

5. **Cost Considerations:**
   - Vertical: Lower initial cost, simpler management
   - Horizontal: Higher cost, better scalability
   - Consider growth trajectory

---

## Additional Resources

- [Scaling WordPress - WordPress Developer Resources](https://developer.wordpress.org/advanced-administration/performance/scaling/)
- [High Availability - WordPress VIP Documentation](https://docs.wpvip.com/)
- [Load Balancing - Nginx Documentation](https://nginx.org/en/docs/http/load_balancing.html)
