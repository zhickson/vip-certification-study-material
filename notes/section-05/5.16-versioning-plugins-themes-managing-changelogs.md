# 5.16 Versioning Plugins/Themes and Managing Changelogs - Study Notes

## Overview

Proper versioning and changelog management communicate updates effectively to users and clients. Semantic versioning provides clear version numbers, while changelogs document what changed and why.

**Key Reference:** [Semantic Versioning](https://semver.org/)

---

## 1. Applying Semantic Versioning

### Version Format

```
MAJOR.MINOR.PATCH

1.2.3
│ │ │
│ │ └─ Patch: Bug fixes
│ └─── Minor: New features (backward compatible)
└───── Major: Breaking changes
```

### Version Rules

- **MAJOR:** Breaking changes (incompatible API changes)
- **MINOR:** New features (backward compatible)
- **PATCH:** Bug fixes (backward compatible)

### Examples

```php
// Version 1.0.0 - Initial release
// Version 1.0.1 - Bug fix
// Version 1.1.0 - New feature (backward compatible)
// Version 2.0.0 - Breaking changes
// Version 2.0.1 - Bug fix after major release
// Version 2.1.0 - New feature
```

### Setting Version in Code

```php
// Plugin header
<?php
/**
 * Plugin Name: My Plugin
 * Version: 1.2.3
 */

// Or define constant
define( 'MY_PLUGIN_VERSION', '1.2.3' );

// Use in code
$version = MY_PLUGIN_VERSION;
```

### Version in package.json

```json
{
  "name": "my-plugin",
  "version": "1.2.3",
  "description": "My WordPress Plugin"
}
```

---

## 2. Writing Clear Changelogs

### Changelog Format

```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.2.3] - 2024-01-15

### Added
- New user registration feature
- Email notification system

### Changed
- Improved admin interface layout
- Updated documentation

### Fixed
- Resolved login bug on mobile devices
- Fixed database query performance issue

### Security
- Patched XSS vulnerability in form handling

## [1.2.2] - 2024-01-10

### Fixed
- Critical bug in payment processing
```

### Changelog Sections

```markdown
## [Version] - Date

### Added
- New features

### Changed
- Changes to existing features

### Deprecated
- Features that will be removed

### Removed
- Removed features

### Fixed
- Bug fixes

### Security
- Security patches
```

### Good Changelog Entry

```markdown
## [1.2.3] - 2024-01-15

### Added
- User can now reset password via email
- Added two-factor authentication option
- New admin dashboard widget for user statistics

### Changed
- Improved password strength requirements
- Updated email templates for better readability
- Admin interface now uses responsive design

### Fixed
- Resolved issue where users couldn't log in after password reset
- Fixed memory leak in user query function
- Corrected timezone handling in user activity logs

### Security
- Patched SQL injection vulnerability in user search
- Updated authentication nonce validation
```

---

## 3. Managing Version Updates in Git

### Tagging Versions

```bash
# Create version tag
git tag -a v1.2.3 -m "Release version 1.2.3"

# Push tag
git push origin v1.2.3

# List tags
git tag -l

# Show tag details
git show v1.2.3
```

### Version Bump Script

```bash
#!/bin/bash
# bump-version.sh

VERSION_TYPE=$1  # major, minor, patch

if [ -z "$VERSION_TYPE" ]; then
	echo "Usage: ./bump-version.sh [major|minor|patch]"
	exit 1
fi

# Get current version
CURRENT=$(grep "Version:" my-plugin.php | sed 's/.*Version: *\([0-9.]*\).*/\1/')

# Bump version
IFS='.' read -ra VERSION <<< "$CURRENT"
MAJOR=${VERSION[0]}
MINOR=${VERSION[1]}
PATCH=${VERSION[2]}

case $VERSION_TYPE in
	major)
		MAJOR=$((MAJOR + 1))
		MINOR=0
		PATCH=0
		;;
	minor)
		MINOR=$((MINOR + 1))
		PATCH=0
		;;
	patch)
		PATCH=$((PATCH + 1))
		;;
esac

NEW_VERSION="$MAJOR.$MINOR.$PATCH"

# Update version in files
sed -i "s/Version: $CURRENT/Version: $NEW_VERSION/" my-plugin.php
sed -i "s/\"version\": \"$CURRENT\"/\"version\": \"$NEW_VERSION\"/" package.json

# Commit
git add my-plugin.php package.json
git commit -m "Bump version to $NEW_VERSION"

echo "Version bumped to $NEW_VERSION"
```

### Automated Versioning

```yaml
# .github/workflows/version.yml
name: Version Bump

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Extract version
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ steps.version.outputs.VERSION }}
          release_name: Release ${{ steps.version.outputs.VERSION }}
          body_path: CHANGELOG.md
          draft: false
          prerelease: false
```

---

## 4. Managing Changelogs for Users and Clients

### User-Facing Changelog

```markdown
# What's New in Version 1.2.3

## New Features
- **Password Reset:** You can now reset your password via email
- **Two-Factor Authentication:** Added extra security layer for your account

## Improvements
- Faster page load times
- Better mobile experience
- Improved email notifications

## Bug Fixes
- Fixed login issues on mobile devices
- Resolved password reset email delivery problems

## Security
- Enhanced security measures
- Updated authentication system

---

[View Full Changelog](https://example.com/changelog)
```

### Client-Facing Release Notes

```markdown
# Release Notes - Version 1.2.3
**Release Date:** January 15, 2024

## Overview
This release includes significant improvements to user authentication and security.

## Key Changes

### User Authentication
- Implemented password reset functionality
- Added two-factor authentication option
- Improved password strength requirements

### Security Enhancements
- Patched security vulnerabilities
- Enhanced authentication system
- Updated security best practices

### Performance
- Optimized database queries
- Improved page load times
- Reduced server resource usage

## Upgrade Notes
- No database migration required
- No configuration changes needed
- Backward compatible with previous versions

## Support
For questions or issues, contact support@example.com
```

### WordPress Readme Format

```txt
=== My Plugin ===
Contributors: myusername
Tags: plugin, feature
Requires at least: 6.0
Tested up to: 6.4
Stable tag: 1.2.3
License: GPLv2 or later

== Description ==
Plugin description here.

== Changelog ==

= 1.2.3 =
* Added password reset functionality
* Fixed login bug on mobile devices
* Security improvements

= 1.2.2 =
* Fixed critical payment bug
* Improved admin interface

= 1.2.1 =
* Minor bug fixes
* Performance improvements
```

---

## 5. Ensuring Compatibility with WordPress Releases

### WordPress Version Compatibility

```php
// Check WordPress version
if ( version_compare( get_bloginfo( 'version' ), '6.0', '<' ) ) {
	deactivate_plugins( plugin_basename( __FILE__ ) );
	add_action( 'admin_notices', function() {
		echo '<div class="error"><p>My Plugin requires WordPress 6.0 or higher.</p></div>';
	} );
	return;
}
```

### Testing Compatibility

```bash
# Test against multiple WordPress versions
# .github/workflows/test-compatibility.yml
strategy:
  matrix:
    wp-version: [6.0, 6.1, 6.2, 6.3, 6.4]

steps:
  - name: Install WordPress ${{ matrix.wp-version }}
    run: |
      wp core download --version=${{ matrix.wp-version }}
      wp core install
```

### Compatibility Declaration

```php
// Plugin header
/**
 * Requires at least: 6.0
 * Tested up to: 6.4
 * Requires PHP: 7.4
 */

// Or in code
add_action( 'admin_init', function() {
	if ( version_compare( PHP_VERSION, '7.4', '<' ) ) {
		deactivate_plugins( plugin_basename( __FILE__ ) );
	}
} );
```

### Deprecation Warnings

```php
// Warn about deprecated WordPress functions
if ( function_exists( 'wp_deprecated_function' ) ) {
	wp_deprecated_function( 'old_function', '1.2.0', 'new_function' );
}
```

---

## 6. Version Management Best Practices

### Version Consistency

```bash
# Keep versions in sync across files
# - Plugin header (my-plugin.php)
# - package.json
# - composer.json (if applicable)
# - README.md
# - CHANGELOG.md
```

### Release Process

```bash
# 1. Update version
./bump-version.sh minor

# 2. Update changelog
# Edit CHANGELOG.md

# 3. Commit changes
git add .
git commit -m "Prepare release 1.2.3"

# 4. Tag release
git tag -a v1.2.3 -m "Release version 1.2.3"

# 5. Push
git push origin main --tags

# 6. Create release (GitHub/GitLab)
# Use changelog as release notes
```

### Pre-Release Checklist

```markdown
# Pre-Release Checklist

- [ ] Version bumped in all files
- [ ] Changelog updated
- [ ] Tests passing
- [ ] Compatibility tested
- [ ] Documentation updated
- [ ] Release notes prepared
- [ ] Tag created
- [ ] Release created
```

---

## Exam Tips

### Key Points to Remember

1. **Semantic Versioning:**
   - MAJOR.MINOR.PATCH
   - Major: Breaking changes
   - Minor: New features
   - Patch: Bug fixes

2. **Changelogs:**
   - Clear, organized format
   - User-friendly language
   - Document all changes
   - Include security notes

3. **Version Management:**
   - Tag releases in Git
   - Keep versions in sync
   - Automated versioning
   - Release process

4. **Compatibility:**
   - Test against WordPress versions
   - Declare requirements
   - Handle deprecations
   - Maintain backward compatibility

5. **Best Practices:**
   - Consistent versioning
   - Clear changelogs
   - User-friendly release notes
   - Regular updates

---

## Additional Resources

- [Semantic Versioning](https://semver.org/)
- [Keep a Changelog](https://keepachangelog.com/)
- [WordPress Plugin Readme](https://developer.wordpress.org/plugins/plugin-basics/header-requirements/)
- [Version Management](https://www.atlassian.com/git/tutorials/comparing-workflows)
